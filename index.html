<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pilates Pro Manager | Login</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      :root {
        --turquoise: #40e0d0;
        --turquoise-dark: #20b2aa;
        --turquoise-light: #afeeee;
        --black: #0a0a0a;
        --black-light: #1a1a1a;
        --gray-dark: #2d2d2d;
        --gray: #4a4a4a;
        --gray-light: #e5e5e5;
        --gray-lighter: #f5f5f5;
        --white: #ffffff;
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --info: #3b82f6;
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.1);
        --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);
        --radius: 0.5rem;
        --radius-lg: 0.75rem;
        --radius-xl: 1rem;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Inter", sans-serif;
      }

      body {
        background-color: var(--gray-lighter);
        color: var(--black);
        line-height: 1.5;
        overflow-x: hidden;
      }

      body.dark-theme {
        background-color: var(--black);
        color: var(--white);
      }

      /* Tela de Login */
      .login-container {
        display: flex;
        min-height: 100vh;
        align-items: center;
        justify-content: center;
        background: linear-gradient(
          135deg,
          var(--black) 0%,
          var(--black-light) 100%
        );
        padding: 1rem;
      }

      .login-card {
        background: var(--white);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-lg);
        width: 100%;
        max-width: 420px;
        overflow: hidden;
        animation: slideUp 0.5s ease;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .login-header {
        background: linear-gradient(135deg, var(--black), var(--black-light));
        padding: 2.5rem 2rem;
        text-align: center;
        color: var(--white);
      }

      .login-logo {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 1rem;
        margin-bottom: 1rem;
      }

      .login-logo-icon {
        width: 48px;
        height: 48px;
        background: linear-gradient(
          135deg,
          var(--turquoise),
          var(--turquoise-dark)
        );
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
      }

      .login-logo-text {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--turquoise);
      }

      .login-subtitle {
        color: var(--turquoise-light);
        font-size: 0.875rem;
        margin-top: 0.5rem;
      }

      .login-body {
        padding: 2rem;
      }

      .login-form .form-group {
        margin-bottom: 1.5rem;
      }

      .login-form .form-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: var(--black);
        font-size: 0.875rem;
      }

      .login-form .form-control {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 1px solid var(--gray-light);
        border-radius: var(--radius);
        font-size: 0.875rem;
        transition: all 0.2s ease;
        background: var(--white);
        color: var(--black);
      }

      .login-form .form-control:focus {
        outline: none;
        border-color: var(--turquoise);
        box-shadow: 0 0 0 3px rgba(64, 224, 208, 0.1);
      }

      .password-container {
        position: relative;
      }

      .toggle-password {
        position: absolute;
        right: 0.75rem;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: var(--gray);
        cursor: pointer;
        padding: 0.25rem;
      }

      .btn-login {
        width: 100%;
        padding: 0.875rem;
        background: linear-gradient(
          135deg,
          var(--turquoise),
          var(--turquoise-dark)
        );
        color: var(--black);
        border: none;
        border-radius: var(--radius);
        font-weight: 600;
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
      }

      .btn-login:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(64, 224, 208, 0.3);
      }

      .login-footer {
        margin-top: 1.5rem;
        text-align: center;
        color: var(--gray);
        font-size: 0.875rem;
      }

      .login-footer a {
        color: var(--turquoise);
        text-decoration: none;
        font-weight: 500;
      }

      .login-footer a:hover {
        text-decoration: underline;
      }

      /* Layout Principal do Sistema (oculto inicialmente) */
      .app-container {
        display: none;
        min-height: 100vh;
      }

      .sidebar {
        width: 280px;
        background: linear-gradient(
          180deg,
          var(--black) 0%,
          var(--black-light) 100%
        );
        color: var(--white);
        position: fixed;
        height: 100vh;
        z-index: 100;
        transition: transform 0.3s ease;
        box-shadow: var(--shadow-lg);
      }

      .logo-container {
        padding: 1.5rem;
        border-bottom: 1px solid var(--gray-dark);
        display: flex;
        align-items: center;
        gap: 1rem;
        background: var(--black);
      }

      .logo {
        background: linear-gradient(
          135deg,
          var(--turquoise),
          var(--turquoise-dark)
        );
        width: 40px;
        height: 40px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
      }

      .logo-text {
        font-weight: 700;
        font-size: 1.25rem;
        color: var(--turquoise);
      }

      .nav-section {
        padding: 1.5rem 1rem;
        border-bottom: 1px solid var(--gray-dark);
      }

      .nav-section:last-child {
        border-bottom: none;
      }

      .nav-section-title {
        font-size: 0.75rem;
        text-transform: uppercase;
        color: var(--turquoise-light);
        letter-spacing: 0.05em;
        margin-bottom: 1rem;
        font-weight: 600;
      }

      .nav-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 1rem;
        border-radius: var(--radius);
        color: var(--gray-light);
        text-decoration: none;
        margin-bottom: 0.5rem;
        transition: all 0.2s ease;
        position: relative;
        cursor: pointer;
        border: none;
        background: none;
        width: 100%;
        text-align: left;
      }

      .nav-item:hover {
        background: rgba(64, 224, 208, 0.1);
        color: var(--turquoise-light);
      }

      .nav-item.active {
        background: linear-gradient(
          135deg,
          rgba(64, 224, 208, 0.2),
          rgba(32, 178, 170, 0.3)
        );
        color: var(--turquoise);
        border-left: 3px solid var(--turquoise);
        box-shadow: 0 4px 12px rgba(64, 224, 208, 0.15);
      }

      .nav-item .badge {
        position: absolute;
        right: 1rem;
        background: var(--turquoise);
        color: var(--black);
        font-size: 0.75rem;
        padding: 0.125rem 0.5rem;
        border-radius: 9999px;
        font-weight: 600;
      }

      .sidebar-footer {
        position: absolute;
        bottom: 0;
        width: 100%;
        padding: 1.5rem;
        border-top: 1px solid var(--gray-dark);
        background: var(--black);
      }

      .user-profile {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          var(--turquoise),
          var(--turquoise-dark)
        );
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        color: var(--black);
      }

      .user-info h4 {
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--white);
      }

      .user-info p {
        font-size: 0.75rem;
        color: var(--turquoise-light);
      }

      /* Conteúdo Principal */
      .main-content {
        flex: 1;
        margin-left: 280px;
        transition: margin-left 0.3s ease;
      }

      .topbar {
        background: var(--white);
        padding: 1rem 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: var(--shadow);
        position: sticky;
        top: 0;
        z-index: 50;
        border-bottom: 1px solid var(--gray-light);
      }

      .topbar-left {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .menu-toggle {
        display: none;
        background: none;
        border: none;
        color: var(--gray);
        font-size: 1.25rem;
        cursor: pointer;
      }

      .search-container {
        position: relative;
        width: 400px;
      }

      .search-input {
        width: 100%;
        padding: 0.75rem 1rem 0.75rem 2.5rem;
        border: 1px solid var(--gray-light);
        border-radius: var(--radius);
        background: var(--white);
        font-size: 0.875rem;
        transition: all 0.2s ease;
        color: var(--black);
      }

      .search-input:focus {
        outline: none;
        border-color: var(--turquoise);
        box-shadow: 0 0 0 3px rgba(64, 224, 208, 0.1);
      }

      .search-icon {
        position: absolute;
        left: 0.75rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--gray);
      }

      .topbar-right {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .icon-btn {
        background: none;
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--gray);
        cursor: pointer;
        transition: all 0.2s ease;
        position: relative;
      }

      .icon-btn:hover {
        background: var(--gray-lighter);
        color: var(--black);
      }

      .notification-badge {
        position: absolute;
        top: 0;
        right: 0;
        background: var(--turquoise);
        color: var(--black);
        font-size: 0.75rem;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
      }

      /* Conteúdo da Página */
      .page-container {
        padding: 2rem;
      }

      .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
      }

      .page-title h1 {
        font-size: 1.875rem;
        font-weight: 700;
        color: var(--black);
        margin-bottom: 0.5rem;
      }

      .page-subtitle {
        color: var(--gray);
        font-size: 0.875rem;
      }

      .page-actions {
        display: flex;
        gap: 0.75rem;
      }

      .btn {
        padding: 0.625rem 1.25rem;
        border-radius: var(--radius);
        border: none;
        font-weight: 500;
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
      }

      .btn-primary {
        background: linear-gradient(
          135deg,
          var(--turquoise),
          var(--turquoise-dark)
        );
        color: var(--black);
        font-weight: 600;
      }

      .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(64, 224, 208, 0.3);
      }

      .btn-secondary {
        background: var(--white);
        color: var(--gray);
        border: 1px solid var(--gray-light);
        font-weight: 500;
      }

      .btn-secondary:hover {
        background: var(--gray-lighter);
        border-color: var(--gray);
      }

      .btn-success {
        background: linear-gradient(135deg, var(--success), #059669);
        color: var(--white);
      }

      /* Cards Dashboard */
      .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .dashboard-card {
        background: var(--white);
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        box-shadow: var(--shadow);
        border: 1px solid var(--gray-light);
        transition: transform 0.2s ease;
      }

      .dashboard-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 1rem;
      }

      .card-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: var(--black);
      }

      .card-icon.turquoise {
        background: linear-gradient(
          135deg,
          var(--turquoise),
          var(--turquoise-dark)
        );
      }

      .card-icon.black {
        background: linear-gradient(135deg, var(--black), var(--gray-dark));
        color: var(--white);
      }

      .card-icon.gray {
        background: linear-gradient(135deg, var(--gray), var(--gray-dark));
        color: var(--white);
      }

      .card-trend {
        font-size: 0.875rem;
        display: flex;
        align-items: center;
        gap: 0.25rem;
        font-weight: 500;
      }

      .trend-up {
        color: var(--success);
      }

      .trend-down {
        color: var(--danger);
      }

      .card-value {
        font-size: 1.875rem;
        font-weight: 700;
        color: var(--black);
        margin-bottom: 0.25rem;
      }

      .card-label {
        font-size: 0.875rem;
        color: var(--gray);
      }

      /* Tabelas */
      .table-container {
        background: var(--white);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow);
        overflow: hidden;
        margin-bottom: 2rem;
        border: 1px solid var(--gray-light);
      }

      .table-header {
        padding: 1.5rem;
        border-bottom: 1px solid var(--gray-light);
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: var(--gray-lighter);
      }

      .table-title {
        font-weight: 600;
        color: var(--black);
        font-size: 1.125rem;
      }

      .table-filters {
        display: flex;
        gap: 0.75rem;
        align-items: center;
      }

      .filter-select {
        padding: 0.5rem 2rem 0.5rem 0.75rem;
        border: 1px solid var(--gray-light);
        border-radius: var(--radius);
        background: var(--white);
        font-size: 0.875rem;
        color: var(--gray);
        cursor: pointer;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      thead {
        background: var(--gray-lighter);
      }

      th {
        padding: 1rem 1.5rem;
        text-align: left;
        font-weight: 600;
        color: var(--gray);
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        border-bottom: 1px solid var(--gray-light);
      }

      td {
        padding: 1rem 1.5rem;
        border-bottom: 1px solid var(--gray-light);
        font-size: 0.875rem;
        color: var(--black);
      }

      tbody tr {
        transition: background-color 0.2s ease;
      }

      tbody tr:hover {
        background: rgba(64, 224, 208, 0.05);
      }

      .status-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
      }

      .status-active {
        background: rgba(64, 224, 208, 0.15);
        color: var(--turquoise-dark);
        border: 1px solid rgba(64, 224, 208, 0.3);
      }

      .status-inactive {
        background: rgba(239, 68, 68, 0.15);
        color: var(--danger);
        border: 1px solid rgba(239, 68, 68, 0.3);
      }

      .status-pending {
        background: rgba(245, 158, 11, 0.15);
        color: var(--warning);
        border: 1px solid rgba(245, 158, 11, 0.3);
      }

      .status-paid {
        background: rgba(16, 185, 129, 0.15);
        color: var(--success);
        border: 1px solid rgba(16, 185, 129, 0.3);
      }

      .status-overdue {
        background: rgba(239, 68, 68, 0.15);
        color: var(--danger);
        border: 1px solid rgba(239, 68, 68, 0.3);
      }

      .table-actions {
        display: flex;
        gap: 0.5rem;
      }

      .action-btn {
        width: 32px;
        height: 32px;
        border-radius: 6px;
        border: none;
        background: transparent;
        color: var(--gray);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }

      .action-btn:hover {
        background: var(--gray-lighter);
        color: var(--black);
      }

      .action-btn.edit:hover {
        color: var(--turquoise);
        background: rgba(64, 224, 208, 0.1);
      }

      .action-btn.delete:hover {
        color: var(--danger);
        background: rgba(239, 68, 68, 0.1);
      }

      /* Calendário */
      .calendar-container {
        background: var(--white);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow);
        padding: 1.5rem;
        margin-bottom: 2rem;
        border: 1px solid var(--gray-light);
      }

      .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
      }

      .calendar-navigation {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .calendar-title {
        font-weight: 600;
        font-size: 1.125rem;
        color: var(--black);
      }

      .calendar-weekdays {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 0.5rem;
        margin-bottom: 0.5rem;
      }

      .weekday {
        text-align: center;
        padding: 0.5rem;
        font-weight: 600;
        color: var(--gray);
        font-size: 0.875rem;
      }

      .calendar-days {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 0.5rem;
      }

      .calendar-day {
        min-height: 120px;
        background: var(--gray-lighter);
        border-radius: var(--radius);
        padding: 0.75rem;
        border: 1px solid var(--gray-light);
      }

      .calendar-day.today {
        background: rgba(64, 224, 208, 0.1);
        border-color: var(--turquoise);
      }

      .day-number {
        font-weight: 600;
        color: var(--black);
        margin-bottom: 0.5rem;
      }

      .calendar-event {
        background: var(--turquoise);
        color: var(--black);
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.75rem;
        margin-bottom: 0.25rem;
        cursor: pointer;
        font-weight: 500;
      }

      .calendar-event:hover {
        background: var(--turquoise-dark);
      }

      /* Tabs */
      .tabs {
        display: flex;
        border-bottom: 1px solid var(--gray-light);
        margin-bottom: 1.5rem;
      }

      .tab {
        padding: 0.75rem 1.5rem;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        font-weight: 500;
        color: var(--gray);
        transition: all 0.2s ease;
      }

      .tab:hover {
        color: var(--black);
      }

      .tab.active {
        color: var(--turquoise);
        border-bottom: 3px solid var(--turquoise);
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      /* Modais */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        padding: 1rem;
      }

      .modal-overlay.active {
        display: flex;
      }

      .modal {
        background: var(--white);
        border-radius: var(--radius-xl);
        width: 100%;
        max-width: 800px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: var(--shadow-lg);
        animation: modalSlideIn 0.3s ease;
        border: 1px solid var(--gray-light);
      }

      @keyframes modalSlideIn {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .modal-header {
        padding: 1.5rem 2rem;
        border-bottom: 1px solid var(--gray-light);
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: var(--gray-lighter);
      }

      .modal-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--black);
      }

      .modal-close {
        background: none;
        border: none;
        color: var(--gray);
        cursor: pointer;
        font-size: 1.25rem;
        width: 32px;
        height: 32px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }

      .modal-close:hover {
        background: var(--gray-lighter);
        color: var(--black);
      }

      .modal-body {
        padding: 2rem;
      }

      .form-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;
        margin-bottom: 1.5rem;
      }

      .form-group {
        margin-bottom: 1.25rem;
      }

      .form-group.full-width {
        grid-column: 1 / -1;
      }

      .form-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: var(--black);
        font-size: 0.875rem;
      }

      .form-control {
        width: 100%;
        padding: 0.625rem 0.875rem;
        border: 1px solid var(--gray-light);
        border-radius: var(--radius);
        font-size: 0.875rem;
        transition: all 0.2s ease;
        background: var(--white);
        color: var(--black);
      }

      .form-control:focus {
        outline: none;
        border-color: var(--turquoise);
        box-shadow: 0 0 0 3px rgba(64, 224, 208, 0.1);
      }

      .form-select {
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%234a4a4a'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 0.75rem center;
        background-size: 1rem;
        padding-right: 2.5rem;
      }

      .form-footer {
        padding: 1.5rem 2rem;
        border-top: 1px solid var(--gray-light);
        display: flex;
        justify-content: flex-end;
        gap: 0.75rem;
        background: var(--gray-lighter);
      }

      /* Upload de Arquivos */
      .file-upload-container {
        border: 2px dashed var(--gray-light);
        border-radius: var(--radius);
        padding: 1.5rem;
        text-align: center;
        margin-bottom: 1rem;
        background: var(--gray-lighter);
        transition: all 0.3s ease;
      }

      .file-upload-container:hover {
        border-color: var(--turquoise);
        background: rgba(64, 224, 208, 0.05);
      }

      .file-upload-container.drag-over {
        border-color: var(--turquoise);
        background: rgba(64, 224, 208, 0.1);
      }

      .file-upload-label {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.75rem;
        cursor: pointer;
      }

      .file-upload-icon {
        font-size: 2rem;
        color: var(--turquoise);
      }

      .file-upload-text {
        color: var(--gray);
        font-size: 0.875rem;
      }

      .file-upload-text strong {
        color: var(--turquoise);
      }

      .file-upload-input {
        display: none;
      }

      .file-preview-container {
        margin-top: 1rem;
      }

      .file-preview-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.75rem;
        background: var(--white);
        border: 1px solid var(--gray-light);
        border-radius: var(--radius);
        margin-bottom: 0.5rem;
      }

      .file-preview-info {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        flex: 1;
      }

      .file-preview-icon {
        width: 32px;
        height: 32px;
        background: var(--turquoise);
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--black);
      }

      .file-preview-name {
        font-weight: 500;
        font-size: 0.875rem;
        color: var(--black);
      }

      .file-preview-size {
        font-size: 0.75rem;
        color: var(--gray);
      }

      .file-preview-actions {
        display: flex;
        gap: 0.5rem;
      }

      .file-preview-btn {
        background: none;
        border: none;
        color: var(--gray);
        cursor: pointer;
        padding: 0.25rem;
        border-radius: 4px;
        transition: all 0.2s ease;
      }

      .file-preview-btn:hover {
        background: var(--gray-lighter);
      }

      .file-preview-btn.view:hover {
        color: var(--turquoise);
      }

      .file-preview-btn.remove:hover {
        color: var(--danger);
      }

      /* Lista de Anexos */
      .anexos-container {
        background: var(--gray-lighter);
        border-radius: var(--radius);
        padding: 1rem;
        margin-top: 1rem;
      }

      .anexos-title {
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--black);
        margin-bottom: 0.75rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .anexos-list {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .anexo-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.5rem 0.75rem;
        background: var(--white);
        border: 1px solid var(--gray-light);
        border-radius: var(--radius);
        transition: all 0.2s ease;
      }

      .anexo-item:hover {
        background: rgba(64, 224, 208, 0.05);
        border-color: var(--turquoise);
      }

      .anexo-info {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        flex: 1;
      }

      .anexo-icon {
        width: 28px;
        height: 28px;
        background: var(--turquoise);
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--black);
        font-size: 0.75rem;
      }

      .anexo-details {
        flex: 1;
      }

      .anexo-name {
        font-weight: 500;
        font-size: 0.875rem;
        color: var(--black);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .anexo-meta {
        display: flex;
        gap: 1rem;
        font-size: 0.75rem;
        color: var(--gray);
        margin-top: 0.25rem;
      }

      .anexo-actions {
        display: flex;
        gap: 0.25rem;
      }

      /* Gráficos */
      .charts-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .chart-card {
        background: var(--white);
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        box-shadow: var(--shadow);
        border: 1px solid var(--gray-light);
      }

      .chart-title {
        font-weight: 600;
        color: var(--black);
        margin-bottom: 1rem;
        font-size: 1rem;
      }

      .chart-placeholder {
        height: 300px;
        background: var(--gray-lighter);
        border-radius: var(--radius);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--gray);
      }

      /* Responsividade */
      @media (max-width: 1200px) {
        .sidebar {
          transform: translateX(-100%);
        }

        .sidebar.active {
          transform: translateX(0);
        }

        .main-content {
          margin-left: 0;
        }

        .menu-toggle {
          display: block;
        }

        .charts-container {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 768px) {
        .page-container {
          padding: 1rem;
        }

        .dashboard-grid {
          grid-template-columns: 1fr;
        }

        .form-grid {
          grid-template-columns: 1fr;
        }

        .table-container {
          overflow-x: auto;
        }

        .search-container {
          width: 200px;
        }

        .topbar {
          padding: 1rem;
        }

        .calendar-day {
          min-height: 80px;
        }

        .login-card {
          max-width: 100%;
        }
      }

      /* Animações */
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .fade-in {
        animation: fadeIn 0.3s ease;
      }

      /* Utilitários */
      .loading {
        opacity: 0.7;
        pointer-events: none;
      }

      .empty-state {
        text-align: center;
        padding: 3rem;
        color: var(--gray);
      }

      .empty-state i {
        font-size: 3rem;
        margin-bottom: 1rem;
        color: var(--turquoise);
        opacity: 0.5;
      }

      .page-content {
        display: none;
        animation: fadeIn 0.3s ease;
      }

      .page-content.active {
        display: block;
      }

      /* Contadores de Tabela */
      .table-count {
        font-size: 0.875rem;
        color: var(--gray);
        margin-top: 0.5rem;
      }

      /* Filtros Avançados */
      .advanced-filters {
        background: var(--white);
        border-radius: var(--radius);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: var(--shadow);
        border: 1px solid var(--gray-light);
      }

      .filter-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 1rem;
      }

      /* Valor Monetário */
      .money {
        font-family: "Inter", monospace;
        font-weight: 600;
      }

      .money.positive {
        color: var(--success);
      }

      .money.negative {
        color: var(--danger);
      }

      /* Ações Rápidas */
      .quick-actions {
        display: flex;
        gap: 0.75rem;
        margin-bottom: 1.5rem;
      }

      /* Toast Notifications */
      .toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .toast {
        padding: 12px 20px;
        border-radius: var(--radius);
        background: var(--white);
        box-shadow: var(--shadow-lg);
        display: flex;
        align-items: center;
        gap: 10px;
        animation: slideInRight 0.3s ease;
        min-width: 300px;
        border-left: 4px solid var(--turquoise);
      }

      .toast.success {
        border-left-color: var(--success);
      }

      .toast.error {
        border-left-color: var(--danger);
      }

      .toast.warning {
        border-left-color: var(--warning);
      }

      .toast.info {
        border-left-color: var(--info);
      }

      .toast-icon {
        font-size: 1.25rem;
      }

      .toast.success .toast-icon {
        color: var(--success);
      }

      .toast.error .toast-icon {
        color: var(--danger);
      }

      .toast.warning .toast-icon {
        color: var(--warning);
      }

      .toast.info .toast-icon {
        color: var(--info);
      }

      .toast-message {
        flex: 1;
        font-size: 0.875rem;
        font-weight: 500;
      }

      .toast-close {
        background: none;
        border: none;
        color: var(--gray);
        cursor: pointer;
        padding: 4px;
        border-radius: 4px;
        transition: all 0.2s ease;
      }

      .toast-close:hover {
        background: var(--gray-lighter);
        color: var(--black);
      }

      @keyframes slideInRight {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes slideOutRight {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }

      .chart-card canvas {
        width: 100% !important;
        height: 300px !important;
        max-height: 300px;
      }
    </style>
  </head>
  <body>
    <!-- Tela de Login (VISÍVEL INICIALMENTE) -->
    <div class="login-container" id="loginContainer">
      <div class="login-card">
        <div class="login-header">
          <div class="login-logo">
            <div class="login-logo-icon">
              <i class="fas fa-spa"></i>
            </div>
            <div class="login-logo-text">PILATES PRO</div>
          </div>
          <p class="login-subtitle">Sistema de Gestão Completo</p>
        </div>

        <div class="login-body">
          <form class="login-form" id="loginForm">
            <div class="form-group">
              <label class="form-label" for="email">E-mail</label>
              <input
                type="email"
                class="form-control"
                id="email"
                placeholder="seu@email.com"
                required
              />
            </div>

            <div class="form-group">
              <label class="form-label" for="password">Senha</label>
              <div class="password-container">
                <input
                  type="password"
                  class="form-control"
                  id="password"
                  placeholder="Digite sua senha"
                  required
                />
                <button
                  type="button"
                  class="toggle-password"
                  id="togglePassword"
                >
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>

            <div class="form-group">
              <button type="submit" class="btn-login" id="loginButton">
                <i class="fas fa-sign-in-alt"></i>
                Entrar no Sistema
              </button>
            </div>
          </form>

          <div class="login-footer">
            <p>
              Esqueceu sua senha?
              <a href="#" id="forgotPassword">Clique aqui</a>
            </p>
            <p>Versão 3.0.0 | © 2024 Pilates Pro Manager</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Sistema Principal (OCULTO INICIALMENTE) -->
    <div class="app-container" id="appContainer">
      <!-- Sidebar -->
      <aside class="sidebar" id="sidebar">
        <div class="logo-container">
          <div class="logo">
            <i class="fas fa-spa"></i>
          </div>
          <div class="logo-text">PILATES PRO</div>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Principal</div>
          <button class="nav-item active" data-page="dashboard">
            <i class="fas fa-chart-line"></i>
            Dashboard
          </button>
          <button class="nav-item" data-page="alunos">
            <i class="fas fa-users"></i>
            Alunos
            <span class="badge" id="alunosBadge">0</span>
          </button>
          <button class="nav-item" data-page="agenda">
            <i class="fas fa-calendar-alt"></i>
            Agenda
          </button>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Financeiro</div>
          <button class="nav-item" data-page="mensalidades">
            <i class="fas fa-money-bill-wave"></i>
            Mensalidades
            <span class="badge" id="mensalidadesBadge">0</span>
          </button>
          <button class="nav-item" data-page="contas">
            <i class="fas fa-file-invoice-dollar"></i>
            Contas
            <span class="badge" id="contasBadge">0</span>
          </button>
          <button class="nav-item" data-page="relatorios">
            <i class="fas fa-chart-bar"></i>
            Relatórios
          </button>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Configurações</div>
          <button class="nav-item" data-page="usuarios">
            <i class="fas fa-user-cog"></i>
            Usuários
          </button>
          <button class="nav-item" data-page="planos">
            <i class="fas fa-cubes"></i>
            Planos
          </button>
          <button class="nav-item" data-page="configuracoes">
            <i class="fas fa-cog"></i>
            Configurações
          </button>
          <button class="nav-item" id="logoutButton">
            <i class="fas fa-sign-out-alt"></i>
            Sair
          </button>
        </div>

        <div class="sidebar-footer">
          <div class="user-profile">
            <div class="user-avatar" id="userAvatar">JS</div>
            <div class="user-info">
              <h4 id="userName">João Silva</h4>
              <p id="userRole">Administrador</p>
            </div>
            <button
              class="icon-btn"
              style="margin-left: auto; color: var(--turquoise)"
              id="themeToggle"
            >
              <i class="fas fa-moon"></i>
            </button>
          </div>
        </div>
      </aside>

      <!-- Conteúdo Principal -->
      <main class="main-content">
        <!-- Topbar -->
        <header class="topbar">
          <div class="topbar-left">
            <button class="menu-toggle" id="menuToggle">
              <i class="fas fa-bars"></i>
            </button>
            <div class="search-container">
              <i class="fas fa-search search-icon"></i>
              <input
                type="text"
                class="search-input"
                placeholder="Pesquisar alunos, aulas, documentos..."
              />
            </div>
          </div>
          <div class="topbar-right">
            <button class="icon-btn">
              <i class="far fa-bell"></i>
              <span class="notification-badge">3</span>
            </button>
            <button class="icon-btn">
              <i class="far fa-envelope"></i>
              <span class="notification-badge">5</span>
            </button>
            <button class="icon-btn">
              <i class="fas fa-question-circle"></i>
            </button>
            <div
              style="width: 1px; height: 24px; background: var(--gray-light)"
            ></div>
            <button class="icon-btn" id="themeToggleTop">
              <i class="fas fa-moon"></i>
            </button>
            <button class="icon-btn" id="userMenuBtn">
              <i class="fas fa-user-circle"></i>
            </button>
          </div>
        </header>

        <!-- Conteúdo da Página -->
        <div class="page-container">
          <!-- Dashboard -->
          <div class="page-content active" id="dashboard-content">
            <div class="page-header">
              <div class="page-title">
                <h1>Dashboard</h1>
                <p class="page-subtitle">
                  Bem-vindo de volta, <span id="dashboardUserName">João</span>.
                  Aqui está o resumo do seu estúdio.
                </p>
              </div>
              <div class="page-actions">
                <button class="btn btn-secondary" id="exportDashboardBtn">
                  <i class="fas fa-download"></i>
                  Exportar
                </button>
                <button class="btn btn-primary" id="novaAulaBtn">
                  <i class="fas fa-plus"></i>
                  Nova Aula
                </button>
              </div>
            </div>

            <!-- Métricas -->
            <div class="dashboard-grid">
              <div class="dashboard-card">
                <div class="card-header">
                  <div class="card-icon turquoise">
                    <i class="fas fa-users"></i>
                  </div>
                  <div class="card-trend trend-up">
                    <i class="fas fa-arrow-up"></i>
                    12%
                  </div>
                </div>
                <div class="card-value" id="dashboardAlunosAtivos">0</div>
                <div class="card-label">Alunos Ativos</div>
              </div>

              <div class="dashboard-card">
                <div class="card-header">
                  <div class="card-icon black">
                    <i class="fas fa-money-bill-wave"></i>
                  </div>
                  <div class="card-trend trend-up">
                    <i class="fas fa-arrow-up"></i>
                    8%
                  </div>
                </div>
                <div class="card-value" id="dashboardReceitaMensal">R$ 0</div>
                <div class="card-label">Receita Mensal</div>
              </div>

              <div class="dashboard-card">
                <div class="card-header">
                  <div class="card-icon gray">
                    <i class="fas fa-calendar-check"></i>
                  </div>
                  <div class="card-trend trend-up">
                    <i class="fas fa-arrow-up"></i>
                    5%
                  </div>
                </div>
                <div class="card-value" id="dashboardAulasMes">0</div>
                <div class="card-label">Aulas/Mês</div>
              </div>

              <div class="dashboard-card">
                <div class="card-header">
                  <div class="card-icon turquoise">
                    <i class="fas fa-percentage"></i>
                  </div>
                  <div class="card-trend trend-down">
                    <i class="fas fa-arrow-down"></i>
                    3%
                  </div>
                </div>
                <div class="card-value" id="dashboardOcupacao">0%</div>
                <div class="card-label">Ocupação</div>
              </div>
            </div>

            <!-- Gráficos -->
            <div class="charts-container">
              <div class="chart-card">
                <div class="chart-title">Receita Mensal (últimos 6 meses)</div>
                <canvas id="revenueChart" height="300"></canvas>
              </div>
              <div class="chart-card">
                <div class="chart-title">Distribuição de Planos</div>
                <canvas id="planDistributionChart" height="300"></canvas>
              </div>
            </div>

            <!-- Tabela Próximas Aulas -->
            <div class="table-container">
              <div class="table-header">
                <div class="table-title">Próximas Aulas</div>
                <div class="table-filters">
                  <select class="filter-select" id="filterProximasAulas">
                    <option value="today">Hoje</option>
                    <option value="tomorrow">Amanhã</option>
                    <option value="week">Esta Semana</option>
                    <option value="all" selected>Todas</option>
                  </select>
                </div>
              </div>
              <table>
                <thead>
                  <tr>
                    <th>Horário</th>
                    <th>Aluno</th>
                    <th>Modalidade</th>
                    <th>Instrutor</th>
                    <th>Status</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody id="proximasAulasTable">
                  <!-- Carregado via JS -->
                </tbody>
              </table>
              <div class="table-count" id="proximasAulasCount">
                Carregando aulas...
              </div>
            </div>
          </div>

          <!-- Página Alunos -->
          <div class="page-content" id="alunos-content">
            <div class="page-header">
              <div class="page-title">
                <h1>Alunos</h1>
                <p class="page-subtitle">
                  Gerencie todos os alunos do seu estúdio
                </p>
              </div>
              <div class="page-actions">
                <button class="btn btn-secondary" id="toggleFiltersBtn">
                  <i class="fas fa-filter"></i>
                  Filtrar
                </button>
                <button class="btn btn-primary" id="novoAlunoBtn">
                  <i class="fas fa-plus"></i>
                  Novo Aluno
                </button>
              </div>
            </div>

            <!-- Filtros Avançados -->
            <div
              class="advanced-filters"
              id="alunosFilters"
              style="display: none"
            >
              <div class="filter-row">
                <div>
                  <label class="form-label">Status</label>
                  <select class="form-control form-select" id="filterStatus">
                    <option value="">Todos</option>
                    <option value="ativo">Ativos</option>
                    <option value="inativo">Inativos</option>
                  </select>
                </div>
                <div>
                  <label class="form-label">Plano</label>
                  <select class="form-control form-select" id="filterPlano">
                    <option value="">Todos</option>
                    <option>Mensal</option>
                    <option>Trimestral</option>
                    <option>Semestral</option>
                    <option>Anual</option>
                  </select>
                </div>
                <div>
                  <label class="form-label">Data de Início</label>
                  <input
                    type="date"
                    class="form-control"
                    id="filterDataInicio"
                  />
                </div>
              </div>
              <div class="filter-row">
                <div>
                  <label class="form-label"
                    >Buscar por nome, CPF ou email</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="filterBusca"
                    placeholder="Digite para buscar..."
                  />
                </div>
                <div style="display: flex; align-items: flex-end">
                  <button
                    class="btn btn-secondary"
                    id="clearFiltersBtn"
                    style="margin-right: 0.5rem"
                  >
                    <i class="fas fa-times"></i>
                    Limpar
                  </button>
                  <button class="btn btn-primary" id="applyFiltersBtn">
                    <i class="fas fa-search"></i>
                    Aplicar Filtros
                  </button>
                </div>
              </div>
            </div>

            <div class="table-container">
              <div class="table-header">
                <div class="table-title">Todos os Alunos</div>
                <div class="table-filters">
                  <select class="filter-select" id="sortAlunos">
                    <option value="nome">Ordenar por Nome</option>
                    <option value="data">Ordenar por Data de Início</option>
                    <option value="plano">Ordenar por Plano</option>
                  </select>
                </div>
              </div>
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Aluno</th>
                    <th>CPF</th>
                    <th>Telefone</th>
                    <th>Plano</th>
                    <th>Início</th>
                    <th>Status</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody id="alunosTable">
                  <!-- Carregado via JS -->
                </tbody>
              </table>
              <div class="table-count" id="alunosCount">Carregando...</div>
            </div>
          </div>

          <!-- Página Agenda -->
          <div class="page-content" id="agenda-content">
            <div class="page-header">
              <div class="page-title">
                <h1>Agenda</h1>
                <p class="page-subtitle">
                  Visualize e gerencie todas as aulas agendadas
                </p>
              </div>
              <div class="page-actions">
                <button class="btn btn-secondary" id="printAgendaBtn">
                  <i class="fas fa-print"></i>
                  Imprimir
                </button>
                <button class="btn btn-primary" id="agendarAulaBtn">
                  <i class="fas fa-plus"></i>
                  Agendar Aula
                </button>
              </div>
            </div>

            <div class="calendar-container">
              <div class="calendar-header">
                <div class="calendar-navigation">
                  <button class="btn btn-secondary" id="prevMonthBtn">
                    <i class="fas fa-chevron-left"></i>
                  </button>
                  <div class="calendar-title" id="calendarTitle">
                    Janeiro 2024
                  </div>
                  <button class="btn btn-secondary" id="nextMonthBtn">
                    <i class="fas fa-chevron-right"></i>
                  </button>
                </div>
                <div class="page-actions">
                  <button class="btn btn-secondary" id="viewWeekBtn">
                    Semana
                  </button>
                  <button class="btn btn-primary" id="viewMonthBtn">Mês</button>
                  <button class="btn btn-secondary" id="viewDayBtn">Dia</button>
                </div>
              </div>

              <div class="calendar-weekdays">
                <div class="weekday">Dom</div>
                <div class="weekday">Seg</div>
                <div class="weekday">Ter</div>
                <div class="weekday">Qua</div>
                <div class="weekday">Qui</div>
                <div class="weekday">Sex</div>
                <div class="weekday">Sáb</div>
              </div>

              <div class="calendar-days" id="calendarDays">
                <!-- Calendário gerado via JavaScript -->
              </div>
            </div>

            <div class="table-container">
              <div class="table-header">
                <div class="table-title">Aulas do Dia</div>
                <div class="table-filters">
                  <input
                    type="date"
                    class="form-control"
                    id="filterAulasDia"
                    value="2024-01-15"
                    style="width: auto"
                  />
                </div>
              </div>
              <table>
                <thead>
                  <tr>
                    <th>Horário</th>
                    <th>Aluno</th>
                    <th>Duração</th>
                    <th>Instrutor</th>
                    <th>Sala</th>
                    <th>Status</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody id="aulasDiaTable">
                  <!-- Carregado via JS -->
                </tbody>
              </table>
              <div class="table-count" id="aulasDiaCount">
                Carregando aulas...
              </div>
            </div>
          </div>

          <!-- Página Mensalidades -->
          <div class="page-content" id="mensalidades-content">
            <div class="page-header">
              <div class="page-title">
                <h1>Mensalidades</h1>
                <p class="page-subtitle">
                  Controle de pagamentos e recebimentos
                </p>
              </div>
              <div class="page-actions">
                <button class="btn btn-secondary" id="exportMensalidadesBtn">
                  <i class="fas fa-file-export"></i>
                  Exportar
                </button>
                <button class="btn btn-primary" id="novaCobrancaBtn">
                  <i class="fas fa-plus"></i>
                  Nova Cobrança
                </button>
              </div>
            </div>

            <div class="dashboard-grid">
              <div class="dashboard-card">
                <div class="card-header">
                  <div class="card-icon turquoise">
                    <i class="fas fa-check-circle"></i>
                  </div>
                </div>
                <div class="card-value">
                  <span class="money positive" id="recebidoMes">R$ 0</span>
                </div>
                <div class="card-label">Recebido Este Mês</div>
              </div>
              <div class="dashboard-card">
                <div class="card-header">
                  <div class="card-icon black">
                    <i class="fas fa-clock"></i>
                  </div>
                </div>
                <div class="card-value">
                  <span class="money" id="pendenteMes">R$ 0</span>
                </div>
                <div class="card-label">Pendente</div>
              </div>
              <div class="dashboard-card">
                <div class="card-header">
                  <div class="card-icon gray">
                    <i class="fas fa-exclamation-circle"></i>
                  </div>
                </div>
                <div class="card-value">
                  <span class="money negative" id="atrasadoMes">R$ 0</span>
                </div>
                <div class="card-label">Atrasado</div>
              </div>
            </div>

            <div class="tabs">
              <div class="tab active" data-tab="pendentes">Pendentes</div>
              <div class="tab" data-tab="recebidas">Recebidas</div>
              <div class="tab" data-tab="atrasadas">Atrasadas</div>
              <div class="tab" data-tab="todas">Todas</div>
            </div>

            <div class="tab-content active" id="pendentes-tab">
              <div class="table-container">
                <div class="table-header">
                  <div class="table-title">Mensalidades Pendentes</div>
                  <div class="table-filters">
                    <select
                      class="filter-select"
                      id="filterMensalidadesPendentes"
                    >
                      <option value="thisMonth">Este Mês</option>
                      <option value="nextMonth">Próximo Mês</option>
                      <option value="all" selected>Todos</option>
                    </select>
                  </div>
                </div>
                <table>
                  <thead>
                    <tr>
                      <th>Vencimento</th>
                      <th>Aluno</th>
                      <th>Plano</th>
                      <th>Valor</th>
                      <th>Status</th>
                      <th>Ações</th>
                    </tr>
                  </thead>
                  <tbody id="mensalidadesTable">
                    <!-- Carregado via JS -->
                  </tbody>
                </table>
              </div>
            </div>

            <div class="tab-content" id="recebidas-tab">
              <div class="table-container">
                <div class="table-header">
                  <div class="table-title">Mensalidades Recebidas</div>
                  <div class="table-filters">
                    <select
                      class="filter-select"
                      id="filterMensalidadesRecebidas"
                    >
                      <option value="thisMonth">Este Mês</option>
                      <option value="lastMonth">Mês Anterior</option>
                      <option value="all" selected>Todos</option>
                    </select>
                  </div>
                </div>
                <table>
                  <thead>
                    <tr>
                      <th>Data Pagamento</th>
                      <th>Aluno</th>
                      <th>Plano</th>
                      <th>Valor</th>
                      <th>Forma Pagamento</th>
                      <th>Ações</th>
                    </tr>
                  </thead>
                  <tbody id="mensalidadesRecebidasTable">
                    <!-- Carregado via JS -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Página Contas -->
          <div class="page-content" id="contas-content">
            <div class="page-header">
              <div class="page-title">
                <h1>Contas</h1>
                <p class="page-subtitle">Gerencie contas a pagar e receber</p>
              </div>
              <div class="page-actions">
                <button class="btn btn-secondary" id="syncContasBtn">
                  <i class="fas fa-sync-alt"></i>
                  Sincronizar
                </button>
                <button class="btn btn-primary" id="novaContaBtn">
                  <i class="fas fa-plus"></i>
                  Nova Conta
                </button>
              </div>
            </div>

            <div class="dashboard-grid">
              <div class="dashboard-card">
                <div class="card-header">
                  <div class="card-icon turquoise">
                    <i class="fas fa-arrow-down"></i>
                  </div>
                </div>
                <div class="card-value">
                  <span class="money negative" id="totalPagar">R$ 0</span>
                </div>
                <div class="card-label">Total a Pagar</div>
              </div>
              <div class="dashboard-card">
                <div class="card-header">
                  <div class="card-icon black">
                    <i class="fas fa-arrow-up"></i>
                  </div>
                </div>
                <div class="card-value">
                  <span class="money positive" id="totalReceber">R$ 0</span>
                </div>
                <div class="card-label">Total a Receber</div>
              </div>
              <div class="dashboard-card">
                <div class="card-header">
                  <div class="card-icon gray">
                    <i class="fas fa-calendar-times"></i>
                  </div>
                </div>
                <div class="card-value">
                  <span class="money negative" id="totalVencidas">R$ 0</span>
                </div>
                <div class="card-label">Vencidas</div>
              </div>
            </div>

            <div class="tabs">
              <div class="tab active" data-tab="contas-pagar">
                Contas a Pagar
              </div>
              <div class="tab" data-tab="contas-receber">Contas a Receber</div>
              <div class="tab" data-tab="contas-vencidas">Vencidas</div>
            </div>

            <div class="tab-content active" id="contas-pagar-tab">
              <div class="table-container">
                <div class="table-header">
                  <div class="table-title">Contas a Pagar</div>
                  <div class="table-filters">
                    <select class="filter-select" id="filterContasPagar">
                      <option value="thisMonth">Este Mês</option>
                      <option value="nextMonth">Próximo Mês</option>
                      <option value="all" selected>Todos</option>
                    </select>
                  </div>
                </div>
                <table>
                  <thead>
                    <tr>
                      <th>Descrição</th>
                      <th>Categoria</th>
                      <th>Vencimento</th>
                      <th>Valor</th>
                      <th>Status</th>
                      <th>Ações</th>
                    </tr>
                  </thead>
                  <tbody id="contasPagarTable">
                    <!-- Carregado via JS -->
                  </tbody>
                </table>
              </div>
            </div>

            <div class="tab-content" id="contas-receber-tab">
              <div class="table-container">
                <div class="table-header">
                  <div class="table-title">Contas a Receber</div>
                  <div class="table-filters">
                    <select class="filter-select" id="filterContasReceber">
                      <option value="thisMonth">Este Mês</option>
                      <option value="nextMonth">Próximo Mês</option>
                      <option value="all" selected>Todos</option>
                    </select>
                  </div>
                </div>
                <table>
                  <thead>
                    <tr>
                      <th>Descrição</th>
                      <th>Categoria</th>
                      <th>Vencimento</th>
                      <th>Valor</th>
                      <th>Status</th>
                      <th>Ações</th>
                    </tr>
                  </thead>
                  <tbody id="contasReceberTable">
                    <!-- Carregado via JS -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Página Relatórios -->
          <div class="page-content" id="relatorios-content">
            <div class="page-header">
              <div class="page-title">
                <h1>Relatórios</h1>
                <p class="page-subtitle">Análises e insights do seu estúdio</p>
              </div>
              <div class="page-actions">
                <button class="btn btn-secondary" id="periodoRelatoriosBtn">
                  <i class="fas fa-calendar"></i>
                  Período
                </button>
                <button class="btn btn-primary" id="gerarPDFBtn">
                  <i class="fas fa-file-pdf"></i>
                  Gerar PDF
                </button>
              </div>
            </div>

            <div class="charts-container">
              <div class="chart-card">
                <div class="chart-title">Desempenho Financeiro</div>
                <div class="chart-placeholder">
                  <i class="fas fa-chart-line" style="font-size: 2rem"></i>
                  <span style="margin-left: 1rem">Análise Financeira</span>
                </div>
              </div>
              <div class="chart-card">
                <div class="chart-title">Crescimento de Alunos</div>
                <div class="chart-placeholder">
                  <i class="fas fa-chart-bar" style="font-size: 2rem"></i>
                  <span style="margin-left: 1rem">Evolução de Matrículas</span>
                </div>
              </div>
            </div>

            <div class="table-container">
              <div class="table-header">
                <div class="table-title">Resumo Financeiro Detalhado</div>
                <div class="table-filters">
                  <select class="filter-select" id="filterRelatorio">
                    <option value="30days">Últimos 30 dias</option>
                    <option value="90days">Últimos 90 dias</option>
                    <option value="thisYear" selected>Este Ano</option>
                  </select>
                </div>
              </div>
              <table>
                <thead>
                  <tr>
                    <th>Categoria</th>
                    <th>Receitas</th>
                    <th>Despesas</th>
                    <th>Saldo</th>
                    <th>Variação</th>
                  </tr>
                </thead>
                <tbody id="relatorioFinanceiroTable">
                  <!-- Carregado via JS -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- Página Usuários -->
          <div class="page-content" id="usuarios-content">
            <div class="page-header">
              <div class="page-title">
                <h1>Usuários</h1>
                <p class="page-subtitle">
                  Gerencie usuários e permissões do sistema
                </p>
              </div>
              <div class="page-actions">
                <button class="btn btn-secondary" id="permissionsBtn">
                  <i class="fas fa-key"></i>
                  Permissões
                </button>
                <button class="btn btn-primary" id="novoUsuarioBtn">
                  <i class="fas fa-user-plus"></i>
                  Novo Usuário
                </button>
              </div>
            </div>

            <div class="table-container">
              <div class="table-header">
                <div class="table-title">Todos os Usuários</div>
                <div class="table-filters">
                  <select class="filter-select" id="filterPerfil">
                    <option value="all" selected>Todos os Perfis</option>
                    <option value="admin">Administrador</option>
                    <option value="instructor">Instrutor</option>
                    <option value="receptionist">Recepcionista</option>
                  </select>
                </div>
              </div>
              <table>
                <thead>
                  <tr>
                    <th>Usuário</th>
                    <th>Email</th>
                    <th>Perfil</th>
                    <th>Último Acesso</th>
                    <th>Status</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody id="usuariosTable">
                  <!-- Carregado via JS -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- Página Planos -->
          <div class="page-content" id="planos-content">
            <div class="page-header">
              <div class="page-title">
                <h1>Planos</h1>
                <p class="page-subtitle">
                  Configure os planos disponíveis para os alunos
                </p>
              </div>
              <div class="page-actions">
                <button class="btn btn-primary" id="novoPlanoBtn">
                  <i class="fas fa-plus"></i>
                  Novo Plano
                </button>
              </div>
            </div>

            <div class="dashboard-grid">
              <div class="dashboard-card">
                <div class="card-header">
                  <div class="card-icon turquoise">
                    <i class="fas fa-file-contract"></i>
                  </div>
                </div>
                <div class="card-value" id="planosAtivos">0</div>
                <div class="card-label">Planos Ativos</div>
              </div>
              <div class="dashboard-card">
                <div class="card-header">
                  <div class="card-icon black">
                    <i class="fas fa-users"></i>
                  </div>
                </div>
                <div class="card-value" id="alunosComPlano">0</div>
                <div class="card-label">Alunos com Plano</div>
              </div>
            </div>

            <div class="table-container">
              <div class="table-header">
                <div class="table-title">Planos Disponíveis</div>
              </div>
              <table>
                <thead>
                  <tr>
                    <th>Nome do Plano</th>
                    <th>Duração</th>
                    <th>Aulas/Semana</th>
                    <th>Valor Mensal</th>
                    <th>Alunos Ativos</th>
                    <th>Status</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody id="planosTable">
                  <!-- Carregado via JS -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- Página Configurações -->
          <div class="page-content" id="configuracoes-content">
            <div class="page-header">
              <div class="page-title">
                <h1>Configurações</h1>
                <p class="page-subtitle">
                  Configure as preferências do sistema
                </p>
              </div>
              <div class="page-actions">
                <button class="btn btn-primary" id="saveSettingsBtn">
                  <i class="fas fa-save"></i>
                  Salvar Configurações
                </button>
              </div>
            </div>

            <div class="dashboard-grid">
              <div class="dashboard-card">
                <div class="card-header">
                  <div class="card-icon turquoise">
                    <i class="fas fa-building"></i>
                  </div>
                </div>
                <div class="card-value">Pilates Pro</div>
                <div class="card-label">Nome do Estúdio</div>
              </div>
              <div class="dashboard-card">
                <div class="card-header">
                  <div class="card-icon black">
                    <i class="fas fa-clock"></i>
                  </div>
                </div>
                <div class="card-value">08:00 - 20:00</div>
                <div class="card-label">Horário de Funcionamento</div>
              </div>
            </div>

            <div class="table-container">
              <div class="table-header">
                <div class="table-title">Configurações Gerais</div>
              </div>
              <div class="modal-body">
                <div class="form-grid">
                  <div class="form-group full-width">
                    <label class="form-label">Nome do Estúdio</label>
                    <input
                      type="text"
                      class="form-control"
                      id="studioName"
                      value="Pilates Pro Studio"
                    />
                  </div>
                  <div class="form-group">
                    <label class="form-label">Horário de Abertura</label>
                    <input
                      type="time"
                      class="form-control"
                      id="openTime"
                      value="08:00"
                    />
                  </div>
                  <div class="form-group">
                    <label class="form-label">Horário de Fechamento</label>
                    <input
                      type="time"
                      class="form-control"
                      id="closeTime"
                      value="20:00"
                    />
                  </div>
                  <div class="form-group">
                    <label class="form-label"
                      >Duração Padrão da Aula (minutos)</label
                    >
                    <select
                      class="form-control form-select"
                      id="defaultDuration"
                    >
                      <option>45</option>
                      <option selected>60</option>
                      <option>90</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Notificações por Email</label>
                    <select
                      class="form-control form-select"
                      id="emailNotifications"
                    >
                      <option selected>Ativadas</option>
                      <option>Desativadas</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Modal Novo Aluno -->
    <div class="modal-overlay" id="alunoModal">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-title" id="alunoModalTitle">Novo Aluno</div>
          <button class="modal-close" id="closeAlunoModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <form id="alunoForm">
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Nome Completo *</label>
                <input
                  type="text"
                  class="form-control"
                  id="alunoNome"
                  required
                />
              </div>
              <div class="form-group">
                <label class="form-label">CPF *</label>
                <input
                  type="text"
                  class="form-control"
                  id="alunoCPF"
                  placeholder="000.000.000-00"
                  required
                />
              </div>
              <div class="form-group">
                <label class="form-label">Data de Nascimento</label>
                <input type="date" class="form-control" id="alunoNascimento" />
              </div>
              <div class="form-group">
                <label class="form-label">Telefone</label>
                <input
                  type="tel"
                  class="form-control"
                  id="alunoTelefone"
                  placeholder="(00) 00000-0000"
                />
              </div>
              <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-control" id="alunoEmail" />
              </div>
              <div class="form-group">
                <label class="form-label">Plano</label>
                <select class="form-control form-select" id="alunoPlano">
                  <option value="">Selecione</option>
                  <option>Mensal</option>
                  <option>Trimestral</option>
                  <option>Semestral</option>
                  <option>Anual</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Data de Início</label>
                <input type="date" class="form-control" id="alunoInicio" />
              </div>
              <div class="form-group">
                <label class="form-label">Status</label>
                <select class="form-control form-select" id="alunoStatus">
                  <option value="ativo">Ativo</option>
                  <option value="inativo">Inativo</option>
                </select>
              </div>

              <!-- Upload de Anexos -->
              <div class="form-group full-width">
                <label class="form-label">Anexos (Documentos do Aluno)</label>
                <div class="file-upload-container" id="alunoFileUpload">
                  <label class="file-upload-label">
                    <i class="fas fa-cloud-upload-alt file-upload-icon"></i>
                    <div class="file-upload-text">
                      <strong>Clique para fazer upload</strong> ou arraste e
                      solte os arquivos
                    </div>
                    <div class="file-upload-text">
                      Tamanho máximo: 10MB por arquivo
                    </div>
                    <input
                      type="file"
                      class="file-upload-input"
                      id="alunoFileInput"
                      multiple
                      accept=".pdf,.jpg,.jpeg,.png,.doc,.docx"
                    />
                  </label>
                </div>
                <div class="file-preview-container" id="alunoFilePreview"></div>

                <!-- Lista de Anexos Existentes (para edição) -->
                <div
                  class="anexos-container"
                  id="alunoAnexosExistentes"
                  style="display: none"
                >
                  <div class="anexos-title">
                    <i class="fas fa-paperclip"></i>
                    Anexos Existentes
                  </div>
                  <div class="anexos-list" id="alunoAnexosList"></div>
                </div>
              </div>

              <div class="form-group full-width">
                <label class="form-label">Observações</label>
                <textarea
                  class="form-control"
                  id="alunoObservacoes"
                  rows="3"
                ></textarea>
              </div>
            </div>
          </form>
        </div>
        <div class="form-footer">
          <button class="btn btn-secondary" id="cancelAluno">Cancelar</button>
          <button class="btn btn-primary" id="saveAluno">Salvar Aluno</button>
        </div>
      </div>
    </div>

    <!-- Modal Nova Aula -->
    <div class="modal-overlay" id="aulaModal">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-title" id="aulaModalTitle">Agendar Nova Aula</div>
          <button class="modal-close" id="closeAulaModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <form id="aulaForm">
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Aluno *</label>
                <select
                  class="form-control form-select"
                  id="aulaAluno"
                  required
                >
                  <option value="">Selecione um aluno</option>
                  <!-- Preenchido via JavaScript -->
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Data *</label>
                <input
                  type="date"
                  class="form-control"
                  id="aulaData"
                  required
                />
              </div>
              <div class="form-group">
                <label class="form-label">Hora de Início *</label>
                <input
                  type="time"
                  class="form-control"
                  id="aulaHoraInicio"
                  required
                />
              </div>
              <div class="form-group">
                <label class="form-label">Hora de Término *</label>
                <input
                  type="time"
                  class="form-control"
                  id="aulaHoraFim"
                  required
                />
              </div>
              <div class="form-group">
                <label class="form-label">Modalidade</label>
                <select class="form-control form-select" id="aulaModalidade">
                  <option>Individual</option>
                  <option>Em Grupo</option>
                  <option>Dupla</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Instrutor</label>
                <select class="form-control form-select" id="aulaInstrutor">
                  <option>João Silva</option>
                  <option>Maria Santos</option>
                  <option>Carlos Oliveira</option>
                </select>
              </div>

              <!-- Upload de Anexos para Aula -->
              <div class="form-group full-width">
                <label class="form-label"
                  >Anexos da Aula (Avaliações, Observações)</label
                >
                <div class="file-upload-container" id="aulaFileUpload">
                  <label class="file-upload-label">
                    <i class="fas fa-cloud-upload-alt file-upload-icon"></i>
                    <div class="file-upload-text">
                      <strong>Clique para fazer upload</strong> ou arraste e
                      solte os arquivos
                    </div>
                    <div class="file-upload-text">
                      Tamanho máximo: 10MB por arquivo
                    </div>
                    <input
                      type="file"
                      class="file-upload-input"
                      id="aulaFileInput"
                      multiple
                      accept=".pdf,.jpg,.jpeg,.png,.doc,.docx"
                    />
                  </label>
                </div>
                <div class="file-preview-container" id="aulaFilePreview"></div>

                <!-- Lista de Anexos Existentes (para edição) -->
                <div
                  class="anexos-container"
                  id="aulaAnexosExistentes"
                  style="display: none"
                >
                  <div class="anexos-title">
                    <i class="fas fa-paperclip"></i>
                    Anexos Existentes
                  </div>
                  <div class="anexos-list" id="aulaAnexosList"></div>
                </div>
              </div>

              <div class="form-group full-width">
                <label class="form-label">Observações</label>
                <textarea
                  class="form-control"
                  id="aulaObservacoes"
                  rows="3"
                ></textarea>
              </div>
            </div>
          </form>
        </div>
        <div class="form-footer">
          <button class="btn btn-secondary" id="cancelAula">Cancelar</button>
          <button class="btn btn-primary" id="saveAula">Agendar Aula</button>
        </div>
      </div>
    </div>

    <!-- MODAIS NOVOS (CORREÇÕES DO RELATÓRIO DE TESTES) -->

    <!-- Modal Nova Cobrança -->
    <div class="modal-overlay" id="cobrancaModal">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-title">Nova Cobrança</div>
          <button class="modal-close" id="closeCobrancaModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <form id="cobrancaForm">
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Aluno *</label>
                <select
                  class="form-control form-select"
                  id="cobrancaAluno"
                  required
                >
                  <option value="">Selecione um aluno</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Tipo de Cobrança *</label>
                <select class="form-control form-select" id="cobrancaTipo" required>
                  <option value="">Selecione</option>
                  <option value="mensalidade">Mensalidade</option>
                  <option value="avulsa">Aula Avulsa</option>
                  <option value="produto">Produto</option>
                  <option value="outro">Outro</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Valor *</label>
                <input
                  type="number"
                  class="form-control"
                  id="cobrancaValor"
                  step="0.01"
                  min="0"
                  required
                  placeholder="0,00"
                />
              </div>
              <div class="form-group">
                <label class="form-label">Data de Vencimento *</label>
                <input
                  type="date"
                  class="form-control"
                  id="cobrancaVencimento"
                  required
                />
              </div>
              <div class="form-group">
                <label class="form-label">Forma de Pagamento</label>
                <select class="form-control form-select" id="cobrancaFormaPagamento">
                  <option value="">Selecione</option>
                  <option value="dinheiro">Dinheiro</option>
                  <option value="cartao_credito">Cartão de Crédito</option>
                  <option value="cartao_debito">Cartão de Débito</option>
                  <option value="pix">PIX</option>
                  <option value="transferencia">Transferência Bancária</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Status</label>
                <select class="form-control form-select" id="cobrancaStatus">
                  <option value="pendente">Pendente</option>
                  <option value="pago">Pago</option>
                  <option value="atrasado">Atrasado</option>
                  <option value="cancelado">Cancelado</option>
                </select>
              </div>
              <div class="form-group full-width">
                <label class="form-label">Descrição</label>
                <textarea
                  class="form-control"
                  id="cobrancaDescricao"
                  rows="3"
                  placeholder="Descrição detalhada da cobrança..."
                ></textarea>
              </div>
            </div>
          </form>
        </div>
        <div class="form-footer">
          <button class="btn btn-secondary" id="cancelCobranca">Cancelar</button>
          <button class="btn btn-primary" id="saveCobranca">Salvar Cobrança</button>
        </div>
      </div>
    </div>

    <!-- Modal Nova Conta -->
    <div class="modal-overlay" id="contaModal">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-title">Nova Conta</div>
          <button class="modal-close" id="closeContaModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <form id="contaForm">
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Tipo de Conta *</label>
                <select class="form-control form-select" id="contaTipo" required>
                  <option value="">Selecione</option>
                  <option value="pagar">Conta a Pagar</option>
                  <option value="receber">Conta a Receber</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Descrição *</label>
                <input
                  type="text"
                  class="form-control"
                  id="contaDescricao"
                  required
                  placeholder="Ex: Aluguel, Salário, Material..."
                />
              </div>
              <div class="form-group">
                <label class="form-label">Categoria</label>
                <select class="form-control form-select" id="contaCategoria">
                  <option value="">Selecione</option>
                  <option value="despesa_fixa">Despesa Fixa</option>
                  <option value="despesa_variavel">Despesa Variável</option>
                  <option value="receita_servico">Receita de Serviço</option>
                  <option value="receita_produto">Receita de Produto</option>
                  <option value="investimento">Investimento</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Valor *</label>
                <input
                  type="number"
                  class="form-control"
                  id="contaValor"
                  step="0.01"
                  min="0"
                  required
                  placeholder="0,00"
                />
              </div>
              <div class="form-group">
                <label class="form-label">Data de Vencimento *</label>
                <input
                  type="date"
                  class="form-control"
                  id="contaVencimento"
                  required
                />
              </div>
              <div class="form-group">
                <label class="form-label">Status</label>
                <select class="form-control form-select" id="contaStatus">
                  <option value="pendente">Pendente</option>
                  <option value="pago">Pago</option>
                  <option value="recebido">Recebido</option>
                  <option value="atrasado">Atrasado</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Forma de Pagamento</label>
                <select class="form-control form-select" id="contaFormaPagamento">
                  <option value="">Selecione</option>
                  <option value="dinheiro">Dinheiro</option>
                  <option value="cartao">Cartão</option>
                  <option value="pix">PIX</option>
                  <option value="transferencia">Transferência</option>
                  <option value="boleto">Boleto</option>
                </select>
              </div>
              <div class="form-group full-width">
                <label class="form-label">Observações</label>
                <textarea
                  class="form-control"
                  id="contaObservacoes"
                  rows="3"
                  placeholder="Observações adicionais..."
                ></textarea>
              </div>
            </div>
          </form>
        </div>
        <div class="form-footer">
          <button class="btn btn-secondary" id="cancelConta">Cancelar</button>
          <button class="btn btn-primary" id="saveConta">Salvar Conta</button>
        </div>
      </div>
    </div>

    <!-- Modal Novo Usuário -->
    <div class="modal-overlay" id="usuarioModal">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-title">Novo Usuário</div>
          <button class="modal-close" id="closeUsuarioModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <form id="usuarioForm">
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Nome Completo *</label>
                <input
                  type="text"
                  class="form-control"
                  id="usuarioNome"
                  required
                />
              </div>
              <div class="form-group">
                <label class="form-label">Email *</label>
                <input
                  type="email"
                  class="form-control"
                  id="usuarioEmail"
                  required
                  placeholder="usuario@exemplo.com"
                />
              </div>
              <div class="form-group">
                <label class="form-label">Senha *</label>
                <input
                  type="password"
                  class="form-control"
                  id="usuarioSenha"
                  required
                  placeholder="Mínimo 6 caracteres"
                />
              </div>
              <div class="form-group">
                <label class="form-label">Confirmar Senha *</label>
                <input
                  type="password"
                  class="form-control"
                  id="usuarioConfirmarSenha"
                  required
                />
              </div>
              <div class="form-group">
                <label class="form-label">Perfil *</label>
                <select class="form-control form-select" id="usuarioPerfil" required>
                  <option value="">Selecione</option>
                  <option value="administrador">Administrador</option>
                  <option value="instrutor">Instrutor</option>
                  <option value="recepcionista">Recepcionista</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Telefone</label>
                <input
                  type="tel"
                  class="form-control"
                  id="usuarioTelefone"
                  placeholder="(00) 00000-0000"
                />
              </div>
              <div class="form-group">
                <label class="form-label">Status</label>
                <select class="form-control form-select" id="usuarioStatus">
                  <option value="ativo">Ativo</option>
                  <option value="inativo">Inativo</option>
                </select>
              </div>
              <div class="form-group full-width">
                <label class="form-label">Permissões</label>
                <div style="display: flex; flex-wrap: wrap; gap: 1rem;">
                  <label style="display: flex; align-items: center; gap: 0.5rem;">
                    <input type="checkbox" id="permissaoAlunos" checked>
                    <span>Gerenciar Alunos</span>
                  </label>
                  <label style="display: flex; align-items: center; gap: 0.5rem;">
                    <input type="checkbox" id="permissaoAulas" checked>
                    <span>Gerenciar Aulas</span>
                  </label>
                  <label style="display: flex; align-items: center; gap: 0.5rem;">
                    <input type="checkbox" id="permissaoFinanceiro">
                    <span>Gerenciar Financeiro</span>
                  </label>
                  <label style="display: flex; align-items: center; gap: 0.5rem;">
                    <input type="checkbox" id="permissaoRelatorios">
                    <span>Acessar Relatórios</span>
                  </label>
                </div>
              </div>
            </div>
          </form>
        </div>
        <div class="form-footer">
          <button class="btn btn-secondary" id="cancelUsuario">Cancelar</button>
          <button class="btn btn-primary" id="saveUsuario">Salvar Usuário</button>
        </div>
      </div>
    </div>

    <!-- Modal Novo Plano -->
    <div class="modal-overlay" id="planoModal">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-title">Novo Plano</div>
          <button class="modal-close" id="closePlanoModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <form id="planoForm">
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Nome do Plano *</label>
                <input
                  type="text"
                  class="form-control"
                  id="planoNome"
                  required
                  placeholder="Ex: Plano Mensal, Trimestral..."
                />
              </div>
              <div class="form-group">
                <label class="form-label">Duração *</label>
                <select class="form-control form-select" id="planoDuracao" required>
                  <option value="">Selecione</option>
                  <option value="1">1 mês</option>
                  <option value="3">3 meses</option>
                  <option value="6">6 meses</option>
                  <option value="12">12 meses</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Aulas por Semana *</label>
                <select class="form-control form-select" id="planoAulasSemana" required>
                  <option value="">Selecione</option>
                  <option value="1">1 aula</option>
                  <option value="2">2 aulas</option>
                  <option value="3">3 aulas</option>
                  <option value="4">4 aulas</option>
                  <option value="5">5 aulas</option>
                  <option value="ilimitado">Ilimitado</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Valor Mensal *</label>
                <input
                  type="number"
                  class="form-control"
                  id="planoValorMensal"
                  step="0.01"
                  min="0"
                  required
                  placeholder="0,00"
                />
              </div>
              <div class="form-group">
                <label class="form-label">Valor Total</label>
                <input
                  type="text"
                  class="form-control"
                  id="planoValorTotal"
                  readonly
                  placeholder="Calculado automaticamente"
                />
              </div>
              <div class="form-group">
                <label class="form-label">Tipo de Aula</label>
                <select class="form-control form-select" id="planoTipoAula">
                  <option value="individual">Individual</option>
                  <option value="grupo">Em Grupo</option>
                  <option value="ambos">Individual e Grupo</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Status</label>
                <select class="form-control form-select" id="planoStatus">
                  <option value="ativo">Ativo</option>
                  <option value="inativo">Inativo</option>
                </select>
              </div>
              <div class="form-group full-width">
                <label class="form-label">Descrição</label>
                <textarea
                  class="form-control"
                  id="planoDescricao"
                  rows="3"
                  placeholder="Descreva os benefícios deste plano..."
                ></textarea>
              </div>
              <div class="form-group full-width">
                <label class="form-label">Benefícios</label>
                <div style="display: flex; flex-wrap: wrap; gap: 1rem;">
                  <label style="display: flex; align-items: center; gap: 0.5rem;">
                    <input type="checkbox" id="beneficioAvaliacao">
                    <span>Avaliação Física Inclusa</span>
                  </label>
                  <label style="display: flex; align-items: center; gap: 0.5rem;">
                    <input type="checkbox" id="beneficioMaterial">
                    <span>Material de Apoio</span>
                  </label>
                  <label style="display: flex; align-items: center; gap: 0.5rem;">
                    <input type="checkbox" id="beneficioAulaExperimental">
                    <span>Aula Experimental</span>
                  </label>
                  <label style="display: flex; align-items: center; gap: 0.5rem;">
                    <input type="checkbox" id="beneficioDesconto">
                    <span>Desconto em Produtos</span>
                  </label>
                </div>
              </div>
            </div>
          </form>
        </div>
        <div class="form-footer">
          <button class="btn btn-secondary" id="cancelPlano">Cancelar</button>
          <button class="btn btn-primary" id="savePlano">Salvar Plano</button>
        </div>
      </div>
    </div>

    <script>
      // Configuração do IndexedDB
      const DB_NAME = "pilatesProDB";
      const DB_VERSION = 4;
      let db = null;

      // Estado da aplicação
      let currentUser = null;
      let currentPage = "dashboard";
      let currentEditId = null;
      let selectedFiles = {
        alunoModal: [],
        aulaModal: [],
      };
      let calendarMonth = new Date().getMonth();
      let calendarYear = new Date().getFullYear();

      // Dados iniciais para seed
      const seedData = {
        usuarios: [
          {
            id: 1,
            nome: "João Silva",
            email: "joao@pilatespro.com",
            senha: "123456",
            role: "Administrador",
            avatar: "JS",
            status: "ativo",
            ultimoAcesso: "2024-01-15 09:30:00",
            permissoes: ["alunos", "aulas", "financeiro", "relatorios", "usuarios", "planos"]
          },
          {
            id: 2,
            nome: "Maria Santos",
            email: "maria@pilatespro.com",
            senha: "123456",
            role: "Instrutor",
            avatar: "MS",
            status: "ativo",
            ultimoAcesso: "2024-01-15 08:15:00",
            permissoes: ["alunos", "aulas"]
          },
          {
            id: 3,
            nome: "Carlos Oliveira",
            email: "carlos@pilatespro.com",
            senha: "123456",
            role: "Recepcionista",
            avatar: "CO",
            status: "ativo",
            ultimoAcesso: "2024-01-14 14:20:00",
            permissoes: ["alunos", "aulas", "financeiro"]
          },
          {
            id: 4,
            nome: "Ana Paula",
            email: "ana@pilatespro.com",
            senha: "123456",
            role: "Instrutor",
            avatar: "AP",
            status: "ativo",
            ultimoAcesso: "2024-01-14 16:45:00",
            permissoes: ["alunos", "aulas"]
          },
        ],
        alunos: [
          {
            id: 1,
            nome: "Maria Silva",
            cpf: "123.456.789-00",
            telefone: "(11) 99999-9999",
            email: "maria.silva@email.com",
            dataNascimento: "1985-03-15",
            plano: "Anual",
            dataInicio: "2023-10-15",
            status: "ativo",
            observacoes: "Aluna dedicada, possui lesão no ombro",
            anexos: [
              {
                id: 1,
                nome: "contrato.pdf",
                data: "2023-10-15",
                tamanho: "2.4 MB",
                tipo: "pdf",
                arquivo: null,
              },
              {
                id: 2,
                nome: "atestado_medico.jpg",
                data: "2023-10-20",
                tamanho: "1.8 MB",
                tipo: "image",
                arquivo: null,
              },
            ],
          },
          {
            id: 2,
            nome: "João Santos",
            cpf: "987.654.321-00",
            telefone: "(11) 98888-8888",
            email: "joao.santos@email.com",
            dataNascimento: "1990-07-22",
            plano: "Trimestral",
            dataInicio: "2023-11-20",
            status: "ativo",
            observacoes: "Prefere aulas pela manhã",
            anexos: [],
          },
          {
            id: 3,
            nome: "Ana Oliveira",
            cpf: "456.789.123-00",
            telefone: "(11) 97777-7777",
            email: "ana.oliveira@email.com",
            dataNascimento: "1992-11-30",
            plano: "Mensal",
            dataInicio: "2024-01-05",
            status: "ativo",
            observacoes: "Primeira aula realizada com sucesso",
            anexos: [],
          },
          {
            id: 4,
            nome: "Carlos Mendes",
            cpf: "321.654.987-00",
            telefone: "(11) 96666-6666",
            email: "carlos.mendes@email.com",
            dataNascimento: "1988-05-10",
            plano: "Semestral",
            dataInicio: "2023-12-01",
            status: "inativo",
            observacoes: "Transferiu-se para outra cidade",
            anexos: [],
          },
        ],
        aulas: [
          {
            id: 1,
            horario: "2024-01-15 09:00",
            aluno: "Maria Silva",
            alunoId: 1,
            duracao: "60 min",
            instrutor: "João Silva",
            sala: "Sala 1",
            status: "Confirmada",
            anexos: [],
          },
          {
            id: 2,
            horario: "2024-01-15 10:30",
            aluno: "João Santos",
            alunoId: 2,
            duracao: "60 min",
            instrutor: "Maria Santos",
            sala: "Sala 2",
            status: "Confirmada",
            anexos: [],
          },
          {
            id: 3,
            horario: "2024-01-15 14:00",
            aluno: "Ana Oliveira",
            alunoId: 3,
            duracao: "45 min",
            instrutor: "João Silva",
            sala: "Sala 1",
            status: "Pendente",
            anexos: [],
          },
        ],
        mensalidades: [
          {
            id: 1,
            alunoId: 1,
            alunoNome: "Maria Silva",
            valor: 350.0,
            vencimento: "2024-01-10",
            formaPagamento: "Cartão de Crédito",
            status: "Pago",
            dataPagamento: "2024-01-10",
            tipo: "mensalidade",
            descricao: "Mensalidade Janeiro 2024"
          },
          {
            id: 2,
            alunoId: 2,
            alunoNome: "João Santos",
            valor: 320.0,
            vencimento: "2024-01-12",
            formaPagamento: "PIX",
            status: "Pendente",
            dataPagamento: null,
            tipo: "mensalidade",
            descricao: "Mensalidade Janeiro 2024"
          },
          {
            id: 3,
            alunoId: 3,
            alunoNome: "Ana Oliveira",
            valor: 380.0,
            vencimento: "2024-01-15",
            formaPagamento: "Dinheiro",
            status: "Pendente",
            dataPagamento: null,
            tipo: "mensalidade",
            descricao: "Mensalidade Janeiro 2024"
          },
        ],
        planos: [
          {
            id: 1,
            nome: "Mensal",
            duracao: "1 mês",
            aulasSemana: 2,
            valorMensal: 380.0,
            alunosAtivos: 15,
            status: "Ativo",
            descricao: "Plano mensal com 2 aulas por semana",
            beneficios: ["Avaliação Física Inclusa", "Aula Experimental"]
          },
          {
            id: 2,
            nome: "Trimestral",
            duracao: "3 meses",
            aulasSemana: 2,
            valorMensal: 320.0,
            alunosAtivos: 12,
            status: "Ativo",
            descricao: "Plano trimestral com desconto",
            beneficios: ["Avaliação Física Inclusa", "Material de Apoio", "Desconto em Produtos"]
          },
          {
            id: 3,
            nome: "Semestral",
            duracao: "6 meses",
            aulasSemana: 2,
            valorMensal: 290.0,
            alunosAtivos: 8,
            status: "Ativo",
            descricao: "Plano semestral com maior desconto",
            beneficios: ["Avaliação Física Inclusa", "Material de Apoio", "Desconto em Produtos", "Aula Experimental"]
          },
          {
            id: 4,
            nome: "Anual",
            duracao: "12 meses",
            aulasSemana: 2,
            valorMensal: 250.0,
            alunosAtivos: 7,
            status: "Ativo",
            descricao: "Plano anual com máximo desconto",
            beneficios: ["Avaliação Física Inclusa", "Material de Apoio", "Desconto em Produtos", "Aula Experimental", "Acesso Ilimitado"]
          },
        ],
        contas: [
          {
            id: 1,
            descricao: "Aluguel do Studio",
            categoria: "Despesa Fixa",
            vencimento: "2024-01-05",
            valor: 2500.0,
            status: "Pago",
            tipo: "pagar",
            formaPagamento: "Transferência"
          },
          {
            id: 2,
            descricao: "Energia Elétrica",
            categoria: "Despesa Variável",
            vencimento: "2024-01-10",
            valor: 420.0,
            status: "Pago",
            tipo: "pagar",
            formaPagamento: "Boleto"
          },
          {
            id: 3,
            descricao: "Água",
            categoria: "Despesa Variável",
            vencimento: "2024-01-15",
            valor: 120.0,
            status: "Pendente",
            tipo: "pagar",
            formaPagamento: "Boleto"
          },
        ],
        anexos: [],
      };

      // Inicialização do IndexedDB
      function initDB() {
        return new Promise((resolve, reject) => {
          const request = indexedDB.open(DB_NAME, DB_VERSION);

          request.onerror = function (event) {
            console.error("Erro ao abrir IndexedDB:", event.target.error);
            reject(event.target.error);
          };

          request.onsuccess = function (event) {
            db = event.target.result;
            console.log("IndexedDB inicializado com sucesso");
            resolve(db);
          };

          request.onupgradeneeded = function (event) {
            const db = event.target.result;
            const oldVersion = event.oldVersion;

            // Criar object stores se não existirem
            if (!db.objectStoreNames.contains("usuarios")) {
              const store = db.createObjectStore("usuarios", {
                keyPath: "id",
                autoIncrement: true,
              });
              store.createIndex("email", "email", { unique: true });
              store.createIndex("role", "role", { unique: false });
              store.createIndex("status", "status", { unique: false });
            }

            if (!db.objectStoreNames.contains("alunos")) {
              const store = db.createObjectStore("alunos", {
                keyPath: "id",
                autoIncrement: true,
              });
              store.createIndex("nome", "nome", { unique: false });
              store.createIndex("status", "status", { unique: false });
              store.createIndex("plano", "plano", { unique: false });
            }

            if (!db.objectStoreNames.contains("aulas")) {
              const store = db.createObjectStore("aulas", {
                keyPath: "id",
                autoIncrement: true,
              });
              store.createIndex("horario", "horario", { unique: false });
              store.createIndex("alunoId", "alunoId", { unique: false });
              store.createIndex("status", "status", { unique: false });
            }

            if (!db.objectStoreNames.contains("mensalidades")) {
              const store = db.createObjectStore("mensalidades", {
                keyPath: "id",
                autoIncrement: true,
              });
              store.createIndex("alunoId", "alunoId", { unique: false });
              store.createIndex("status", "status", { unique: false });
              store.createIndex("vencimento", "vencimento", { unique: false });
              store.createIndex("tipo", "tipo", { unique: false });
            }

            if (!db.objectStoreNames.contains("planos")) {
              const store = db.createObjectStore("planos", {
                keyPath: "id",
                autoIncrement: true,
              });
              store.createIndex("nome", "nome", { unique: true });
              store.createIndex("status", "status", { unique: false });
            }

            if (!db.objectStoreNames.contains("contas")) {
              const store = db.createObjectStore("contas", {
                keyPath: "id",
                autoIncrement: true,
              });
              store.createIndex("tipo", "tipo", { unique: false });
              store.createIndex("status", "status", { unique: false });
              store.createIndex("vencimento", "vencimento", { unique: false });
            }

            if (!db.objectStoreNames.contains("anexos")) {
              const store = db.createObjectStore("anexos", {
                keyPath: "id",
                autoIncrement: true,
              });
              store.createIndex("entityId", "entityId", { unique: false });
              store.createIndex("entityType", "entityType", { unique: false });
            }
          };
        });
      }

      // Funções CRUD para IndexedDB
      function addItem(storeName, data) {
        return new Promise((resolve, reject) => {
          if (!db) {
            reject(new Error("Banco de dados não inicializado"));
            return;
          }

          const transaction = db.transaction([storeName], "readwrite");
          const store = transaction.objectStore(storeName);
          const request = store.add(data);

          request.onsuccess = function (event) {
            resolve({ ...data, id: event.target.result });
          };

          request.onerror = function (event) {
            reject(event.target.error);
          };
        });
      }

      function updateItem(storeName, data) {
        return new Promise((resolve, reject) => {
          if (!db) {
            reject(new Error("Banco de dados não inicializado"));
            return;
          }

          const transaction = db.transaction([storeName], "readwrite");
          const store = transaction.objectStore(storeName);
          const request = store.put(data);

          request.onsuccess = function () {
            resolve(data);
          };

          request.onerror = function (event) {
            reject(event.target.error);
          };
        });
      }

      function deleteItem(storeName, id) {
        return new Promise((resolve, reject) => {
          if (!db) {
            reject(new Error("Banco de dados não inicializado"));
            return;
          }

          const transaction = db.transaction([storeName], "readwrite");
          const store = transaction.objectStore(storeName);
          const request = store.delete(id);

          request.onsuccess = function () {
            resolve(true);
          };

          request.onerror = function (event) {
            reject(event.target.error);
          };
        });
      }

      function getItem(storeName, id) {
        return new Promise((resolve, reject) => {
          if (!db) {
            reject(new Error("Banco de dados não inicializado"));
            return;
          }

          const transaction = db.transaction([storeName], "readonly");
          const store = transaction.objectStore(storeName);
          const request = store.get(id);

          request.onsuccess = function (event) {
            resolve(event.target.result);
          };

          request.onerror = function (event) {
            reject(event.target.error);
          };
        });
      }

      function getAllItems(storeName, indexName = null, indexValue = null) {
        return new Promise((resolve, reject) => {
          if (!db) {
            reject(new Error("Banco de dados não inicializado"));
            return;
          }

          const transaction = db.transaction([storeName], "readonly");
          const store = transaction.objectStore(storeName);

          let request;
          if (indexName && indexValue !== null) {
            const index = store.index(indexName);
            request = index.getAll(indexValue);
          } else if (indexName) {
            const index = store.index(indexName);
            request = index.getAll();
          } else {
            request = store.getAll();
          }

          request.onsuccess = function (event) {
            resolve(event.target.result || []);
          };

          request.onerror = function (event) {
            reject(event.target.error);
          };
        });
      }

      function getCount(storeName, indexName = null, indexValue = null) {
        return new Promise((resolve, reject) => {
          if (!db) {
            reject(new Error("Banco de dados não inicializado"));
            return;
          }

          const transaction = db.transaction([storeName], "readonly");
          const store = transaction.objectStore(storeName);

          let request;
          if (indexName && indexValue !== null) {
            const index = store.index(indexName);
            request = index.count(indexValue);
          } else if (indexName) {
            const index = store.index(indexName);
            request = index.count();
          } else {
            request = store.count();
          }

          request.onsuccess = function (event) {
            resolve(event.target.result);
          };

          request.onerror = function (event) {
            reject(event.target.error);
          };
        });
      }

      // População inicial do banco de dados (seed)
      async function seedDatabase() {
        try {
          // Verificar se já existem dados
          const usuariosCount = await getCount("usuarios");

          if (usuariosCount === 0) {
            console.log("Populando banco de dados com dados iniciais...");

            // Adicionar usuários
            for (const usuario of seedData.usuarios) {
              await addItem("usuarios", usuario);
            }

            // Adicionar alunos
            for (const aluno of seedData.alunos) {
              await addItem("alunos", aluno);
            }

            // Adicionar aulas
            for (const aula of seedData.aulas) {
              await addItem("aulas", aula);
            }

            // Adicionar mensalidades
            for (const mensalidade of seedData.mensalidades) {
              await addItem("mensalidades", mensalidade);
            }

            // Adicionar planos
            for (const plano of seedData.planos) {
              await addItem("planos", plano);
            }

            // Adicionar contas
            for (const conta of seedData.contas) {
              await addItem("contas", conta);
            }

            console.log("Banco de dados populado com sucesso");
          }
        } catch (error) {
          console.error("Erro ao popular banco de dados:", error);
        }
      }

      // Inicialização da aplicação
      document.addEventListener("DOMContentLoaded", async function () {
        // Garantir estado inicial
        document.getElementById("loginContainer").style.display = "flex";
        document.getElementById("appContainer").style.display = "none";
        document.getElementById("appContainer").style.opacity = "0";

        try {
          await initDB();
          await seedDatabase();

          initLogin();
          initNavigation();
          initModais(); // Atualizado para incluir novos modais
          initCalendar();
          initTabs();
          setupEventListeners();
          initFileUploads();

          checkLoggedInUser();
        } catch (error) {
          console.error("Erro na inicialização:", error);
          showToast(
            "Erro ao inicializar o sistema. Recarregue a página.",
            "error"
          );
        }
      });

      // Sistema de Login
      function initLogin() {
        const loginForm = document.getElementById("loginForm");
        const togglePassword = document.getElementById("togglePassword");
        const passwordInput = document.getElementById("password");

        togglePassword.addEventListener("click", function () {
          const type =
            passwordInput.getAttribute("type") === "password"
              ? "text"
              : "password";
          passwordInput.setAttribute("type", type);
          this.innerHTML =
            type === "password"
              ? '<i class="fas fa-eye"></i>'
              : '<i class="fas fa-eye-slash"></i>';
        });

        loginForm.addEventListener("submit", async function (e) {
          e.preventDefault();

          const email = document.getElementById("email").value.trim();
          const password = document.getElementById("password").value.trim();

          if (!email || !password) {
            showToast("Por favor, preencha todos os campos", "error");
            return;
          }

          await simulateLogin(email, password);
        });

        document
          .getElementById("forgotPassword")
          .addEventListener("click", function (e) {
            e.preventDefault();
            showToast(
              "Funcionalidade de recuperação de senha em desenvolvimento",
              "info"
            );
          });
      }

      async function simulateLogin(email, password) {
        const loginButton = document.getElementById("loginButton");
        const originalText = loginButton.innerHTML;
        loginButton.innerHTML =
          '<i class="fas fa-spinner fa-spin"></i> Verificando...';
        loginButton.disabled = true;

        try {
          // Buscar usuário no IndexedDB
          const usuarios = await getAllItems("usuarios");
          const user = usuarios.find(
            (u) => u.email === email && u.senha === password
          );

          if (user) {
            currentUser = user;
            localStorage.setItem("pilatesProUser", JSON.stringify(user));
            showToast(`Bem-vindo, ${user.nome}!`, "success");

            updateUserInterface(user);
            transitionToApp();
          } else {
            showToast("E-mail ou senha incorretos", "error");
            loginButton.innerHTML = originalText;
            loginButton.disabled = false;
          }
        } catch (error) {
          console.error("Erro no login:", error);
          showToast("Erro ao fazer login. Tente novamente.", "error");
          loginButton.innerHTML = originalText;
          loginButton.disabled = false;
        }
      }

      function checkLoggedInUser() {
        const savedUser = localStorage.getItem("pilatesProUser");
        if (savedUser) {
          try {
            const user = JSON.parse(savedUser);
            currentUser = user;
            updateUserInterface(user);
            transitionToApp();
          } catch (e) {
            console.error("Erro ao recuperar usuário:", e);
            localStorage.removeItem("pilatesProUser");
          }
        }
      }

      function updateUserInterface(user) {
        document.getElementById("userAvatar").textContent = user.avatar;
        document.getElementById("userName").textContent = user.nome;
        document.getElementById("userRole").textContent = user.role;
        const firstName = user.nome.split(" ")[0];
        document.getElementById("dashboardUserName").textContent = firstName;

        if (user.role === "Recepcionista") {
          document.querySelector(".page-subtitle").textContent =
            "Sistema de gestão do estúdio";
        }
      }

      function transitionToApp() {
        const loginContainer = document.getElementById("loginContainer");
        const appContainer = document.getElementById("appContainer");

        loginContainer.style.opacity = "0";
        loginContainer.style.transform = "translateY(-20px)";

        setTimeout(() => {
          loginContainer.style.display = "none";
          appContainer.style.display = "flex";

          loadDashboardData();

          setTimeout(() => {
            appContainer.style.opacity = "1";
            appContainer.style.transform = "translateY(0)";
          }, 50);
        }, 300);
      }

      function logout() {
        if (confirm("Tem certeza que deseja sair do sistema?")) {
          currentUser = null;
          localStorage.removeItem("pilatesProUser");

          const appContainer = document.getElementById("appContainer");
          const loginContainer = document.getElementById("loginContainer");

          appContainer.style.opacity = "0";
          appContainer.style.transform = "translateY(20px)";

          setTimeout(() => {
            appContainer.style.display = "none";
            loginContainer.style.display = "flex";

            document.getElementById("loginForm").reset();
            document
              .getElementById("password")
              .setAttribute("type", "password");
            document.getElementById("togglePassword").innerHTML =
              '<i class="fas fa-eye"></i>';

            const loginButton = document.getElementById("loginButton");
            loginButton.innerHTML =
              '<i class="fas fa-sign-in-alt"></i> Entrar no Sistema';
            loginButton.disabled = false;

            setTimeout(() => {
              loginContainer.style.opacity = "1";
              loginContainer.style.transform = "translateY(0)";
              showToast("Você saiu do sistema", "info");
            }, 50);
          }, 300);
        }
      }

      // Navegação
      function initNavigation() {
        document.querySelectorAll(".nav-item[data-page]").forEach((item) => {
          item.addEventListener("click", function (e) {
            e.preventDefault();

            if (this.id === "logoutButton") return;

            document
              .querySelectorAll(".nav-item")
              .forEach((i) => i.classList.remove("active"));
            this.classList.add("active");

            const page = this.dataset.page;
            navigateToPage(page);

            if (window.innerWidth < 1200) {
              document.getElementById("sidebar").classList.remove("active");
            }
          });
        });

        document
          .getElementById("menuToggle")
          .addEventListener("click", function () {
            document.getElementById("sidebar").classList.toggle("active");
          });

        document
          .getElementById("logoutButton")
          .addEventListener("click", logout);
      }

      function navigateToPage(page) {
        document.querySelectorAll(".page-content").forEach((content) => {
          content.classList.remove("active");
        });

        const pageElement = document.getElementById(`${page}-content`);
        if (pageElement) {
          pageElement.classList.add("active");
          currentPage = page;

          switch (page) {
            case "dashboard":
              loadDashboardData();
              break;
            case "alunos":
              loadAlunosTable();
              break;
            case "agenda":
              loadAulasTable();
              initCalendar();
              break;
            case "mensalidades":
              loadMensalidadesTable();
              break;
            case "contas":
              loadContasTable();
              break;
            case "relatorios":
              loadRelatoriosTable();
              break;
            case "usuarios":
              loadUsuariosTable();
              break;
            case "planos":
              loadPlanosTable();
              break;
            case "configuracoes":
              break;
          }
        }
      }

      // Dashboard
      async function loadDashboardData() {
        try {
          const alunos = await getAllItems("alunos");
          const aulas = await getAllItems("aulas");
          const mensalidades = await getAllItems("mensalidades");

          // Atualizar métricas
          const alunosAtivos = alunos.filter(
            (a) => a.status === "ativo"
          ).length;
          const hoje = new Date();
          const aulasMes = aulas.filter((a) => {
            const aulaDate = new Date(a.horario);
            return (
              aulaDate.getMonth() === hoje.getMonth() &&
              aulaDate.getFullYear() === hoje.getFullYear()
            );
          }).length;

          // Calcular receita mensal (apenas mensalidades pagas deste mês)
          const receitaMensal = mensalidades
            .filter(
              (m) =>
                m.status === "Pago" &&
                m.dataPagamento &&
                m.dataPagamento.startsWith(
                  hoje.getFullYear() +
                    "-" +
                    String(hoje.getMonth() + 1).padStart(2, "0")
                )
            )
            .reduce((total, m) => total + m.valor, 0);

          document.getElementById("dashboardAlunosAtivos").textContent =
            alunosAtivos;
          document.getElementById(
            "dashboardReceitaMensal"
          ).textContent = `R$ ${receitaMensal.toFixed(2)}`;
          document.getElementById("dashboardAulasMes").textContent = aulasMes;
          document.getElementById("dashboardOcupacao").textContent = "92%";

          // Atualizar contadores de badge
          await updateSidebarBadges();

          loadProximasAulas();
          initCharts();
        } catch (error) {
          console.error("Erro ao carregar dashboard:", error);
        }
      }

      // CORREÇÃO DO RELATÓRIO: Função updateSidebarBadges implementada
      async function updateSidebarBadges() {
        try {
          const alunos = await getAllItems("alunos");
          const mensalidades = await getAllItems("mensalidades");
          const contas = await getAllItems("contas");

          // Atualizar badge de alunos
          const alunosAtivos = alunos.filter(a => a.status === "ativo").length;
          document.getElementById("alunosBadge").textContent = alunosAtivos;

          // Atualizar badge de mensalidades pendentes
          const mensalidadesPendentes = mensalidades.filter(
            (m) => m.status === "Pendente"
          ).length;
          document.getElementById("mensalidadesBadge").textContent =
            mensalidadesPendentes;

          // Atualizar badge de contas pendentes
          const contasPagar = (
            await getAllItems("contas", "tipo", "pagar")
          ).filter((c) => c.status === "Pendente").length;
          document.getElementById("contasBadge").textContent = contasPagar;
        } catch (error) {
          console.error("Erro ao atualizar badges:", error);
        }
      }

      let revenueChart, planDistributionChart;
      function initCharts() {
        // Destruir gráficos existentes se houver
        if (revenueChart) revenueChart.destroy();
        if (planDistributionChart) planDistributionChart.destroy();

        const revenueCtx = document.getElementById("revenueChart");
        if (revenueCtx) {
          revenueChart = new Chart(revenueCtx, {
            type: "line",
            data: {
              labels: ["Jan", "Fev", "Mar", "Abr", "Mai", "Jun"],
              datasets: [
                {
                  label: "Receita Mensal",
                  data: [1200, 1900, 3000, 5000, 2300, 3200],
                  borderColor: "#40E0D0",
                  backgroundColor: "rgba(64, 224, 208, 0.1)",
                  fill: true,
                  tension: 0.4,
                },
              ],
            },
            options: { responsive: true, maintainAspectRatio: false },
          });
        }

        const planCtx = document.getElementById("planDistributionChart");
        if (planCtx) {
          planDistributionChart = new Chart(planCtx, {
            type: "doughnut",
            data: {
              labels: ["Mensal", "Trimestral", "Semestral", "Anual"],
              datasets: [
                {
                  data: [12, 19, 3, 5],
                  backgroundColor: ["#40E0D0", "#3b82f6", "#f59e0b", "#ef4444"],
                },
              ],
            },
            options: { responsive: true, maintainAspectRatio: false },
          });
        }
      }

      async function loadProximasAulas() {
        try {
          const aulas = await getAllItems("aulas");
          const table = document.getElementById("proximasAulasTable");
          if (!table) return;

          const filterValue = document.getElementById(
            "filterProximasAulas"
          ).value;
          let filteredAulas = [...aulas];

          const today = new Date();
          const tomorrow = new Date(today);
          tomorrow.setDate(tomorrow.getDate() + 1);

          if (filterValue === "today") {
            const todayStr = today.toISOString().split("T")[0];
            filteredAulas = filteredAulas.filter((a) =>
              a.horario.startsWith(todayStr)
            );
          } else if (filterValue === "tomorrow") {
            const tomorrowStr = tomorrow.toISOString().split("T")[0];
            filteredAulas = filteredAulas.filter((a) =>
              a.horario.startsWith(tomorrowStr)
            );
          } else if (filterValue === "week") {
            const weekLater = new Date(today);
            weekLater.setDate(weekLater.getDate() + 7);
            filteredAulas = filteredAulas.filter((a) => {
              const aulaDate = new Date(a.horario);
              return aulaDate >= today && aulaDate <= weekLater;
            });
          }

          filteredAulas.sort(
            (a, b) => new Date(a.horario) - new Date(b.horario)
          );

          let html = "";
          filteredAulas.slice(0, 5).forEach((aula) => {
            const [dataStr, hora] = aula.horario.split(" ");
            const statusClass =
              aula.status === "Confirmada" ? "status-active" : "status-pending";
            const statusText =
              aula.status === "Confirmada" ? "Confirmada" : "Pendente";
            const modalidade = aula.duracao.includes("45")
              ? "Individual"
              : aula.duracao.includes("90")
              ? "Dupla"
              : "Em Grupo";

            html += `
                        <tr>
                            <td>${dataStr} ${hora}</td>
                            <td>${aula.aluno}</td>
                            <td>${modalidade}</td>
                            <td>${aula.instrutor}</td>
                            <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                            <td>
                                <div class="table-actions">
                                    <button class="action-btn edit" onclick="editAula(${aula.id})">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn delete" onclick="deleteAula(${aula.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
          });

          if (filteredAulas.length === 0) {
            html = `<tr><td colspan="6" style="text-align: center; padding: 2rem; color: var(--gray);">Nenhuma aula encontrada</td></tr>`;
          }

          table.innerHTML = html;
          document.getElementById(
            "proximasAulasCount"
          ).textContent = `Mostrando ${Math.min(5, filteredAulas.length)} de ${
            aulas.length
          } aulas agendadas`;
        } catch (error) {
          console.error("Erro ao carregar próximas aulas:", error);
        }
      }

      // Alunos
      async function loadAlunosTable() {
        try {
          const alunos = await getAllItems("alunos");
          const table = document.getElementById("alunosTable");
          const countElement = document.getElementById("alunosCount");

          if (!table) return;

          let html = "";
          alunos.forEach((aluno) => {
            const statusClass =
              aluno.status === "ativo" ? "status-active" : "status-inactive";
            const statusText = aluno.status === "ativo" ? "Ativo" : "Inativo";

            html += `
                        <tr>
                            <td>${aluno.id}</td>
                            <td>${aluno.nome}</td>
                            <td>${aluno.cpf}</td>
                            <td>${aluno.telefone}</td>
                            <td>${aluno.plano}</td>
                            <td>${aluno.dataInicio}</td>
                            <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                            <td>
                                <div class="table-actions">
                                    <button class="action-btn edit" onclick="editAluno(${aluno.id})">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn delete" onclick="deleteAluno(${aluno.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
          });

          if (alunos.length === 0) {
            html = `<tr><td colspan="8" style="text-align: center; padding: 2rem; color: var(--gray);">Nenhum aluno cadastrado</td></tr>`;
          }

          table.innerHTML = html;
          countElement.textContent = `${alunos.length} alunos encontrados`;
        } catch (error) {
          console.error("Erro ao carregar alunos:", error);
        }
      }

      async function editAluno(id) {
        try {
          const aluno = await getItem("alunos", id);
          if (!aluno) {
            showToast("Aluno não encontrado", "error");
            return;
          }

          currentEditId = id;
          document.getElementById("alunoModalTitle").textContent =
            "Editar Aluno";
          document.getElementById("alunoNome").value = aluno.nome || "";
          document.getElementById("alunoCPF").value = aluno.cpf || "";
          document.getElementById("alunoNascimento").value =
            aluno.dataNascimento || "";
          document.getElementById("alunoTelefone").value = aluno.telefone || "";
          document.getElementById("alunoEmail").value = aluno.email || "";
          document.getElementById("alunoPlano").value = aluno.plano || "";
          document.getElementById("alunoInicio").value = aluno.dataInicio || "";
          document.getElementById("alunoStatus").value =
            aluno.status || "ativo";
          document.getElementById("alunoObservacoes").value =
            aluno.observacoes || "";

          // Limpar arquivos selecionados
          selectedFiles.alunoModal = [];
          updateFilePreview("alunoFilePreview", selectedFiles.alunoModal);

          // Mostrar anexos existentes
          if (aluno.anexos && aluno.anexos.length > 0) {
            const anexosList = document.getElementById("alunoAnexosList");
            anexosList.innerHTML = "";

            aluno.anexos.forEach((anexo) => {
              const anexoElement = document.createElement("div");
              anexoElement.className = "anexo-item";
              anexoElement.innerHTML = `
                            <div class="anexo-info">
                                <div class="anexo-icon">
                                    <i class="fas fa-file-${
                                      anexo.tipo === "pdf" ? "pdf" : "image"
                                    }"></i>
                                </div>
                                <div class="anexo-details">
                                    <div class="anexo-name">
                                        ${anexo.nome}
                                        <span class="status-badge status-active">Existente</span>
                                    </div>
                                    <div class="anexo-meta">
                                        <span>${anexo.data}</span>
                                        <span>${anexo.tamanho}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="anexo-actions">
                                <button class="file-preview-btn view" onclick="viewAnexo(${
                                  anexo.id
                                }, 'aluno')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="file-preview-btn remove" onclick="removeExistingAnexo(${
                                  anexo.id
                                }, 'aluno')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        `;
              anexosList.appendChild(anexoElement);
            });

            document.getElementById("alunoAnexosExistentes").style.display =
              "block";
          } else {
            document.getElementById("alunoAnexosExistentes").style.display =
              "none";
          }

          openModal("alunoModal");
        } catch (error) {
          console.error("Erro ao carregar aluno para edição:", error);
          showToast("Erro ao carregar aluno", "error");
        }
      }

      async function deleteAluno(id) {
        if (
          confirm(
            "Tem certeza que deseja excluir este aluno? Esta ação não pode ser desfeita."
          )
        ) {
          try {
            await deleteItem("alunos", id);
            showToast("Aluno excluído com sucesso", "success");
            await updateSidebarBadges(); // CORREÇÃO: Chamada da função implementada
            loadAlunosTable();
            loadDashboardData();
          } catch (error) {
            console.error("Erro ao excluir aluno:", error);
            showToast("Erro ao excluir aluno", "error");
          }
        }
      }

      // Aulas
      async function loadAulasTable() {
        try {
          const aulas = await getAllItems("aulas");
          const table = document.getElementById("aulasDiaTable");
          const countElement = document.getElementById("aulasDiaCount");

          if (!table) return;

          const filterDate = document.getElementById("filterAulasDia").value;
          const filteredAulas = aulas.filter((a) =>
            a.horario.startsWith(filterDate)
          );

          let html = "";
          filteredAulas.forEach((aula) => {
            const [dataStr, hora] = aula.horario.split(" ");
            const statusClass =
              aula.status === "Confirmada"
                ? "status-active"
                : aula.status === "Pendente"
                ? "status-pending"
                : "status-inactive";
            const statusText = aula.status;

            html += `
                        <tr>
                            <td>${hora}</td>
                            <td>${aula.aluno}</td>
                            <td>${aula.duracao}</td>
                            <td>${aula.instrutor}</td>
                            <td>${aula.sala}</td>
                            <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                            <td>
                                <div class="table-actions">
                                    <button class="action-btn edit" onclick="editAula(${aula.id})">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn delete" onclick="deleteAula(${aula.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
          });

          if (filteredAulas.length === 0) {
            html = `<tr><td colspan="7" style="text-align: center; padding: 2rem; color: var(--gray);">Nenhuma aula encontrada para esta data</td></tr>`;
          }

          table.innerHTML = html;
          countElement.textContent = `${filteredAulas.length} aulas agendadas para ${filterDate}`;
        } catch (error) {
          console.error("Erro ao carregar aulas:", error);
        }
      }

      async function editAula(id) {
        try {
          const aula = await getItem("aulas", id);
          if (!aula) {
            showToast("Aula não encontrada", "error");
            return;
          }

          currentEditId = id;
          document.getElementById("aulaModalTitle").textContent = "Editar Aula";

          const [data, hora] = aula.horario.split(" ");
          document.getElementById("aulaData").value = data;
          document.getElementById("aulaHoraInicio").value = hora;

          // Calcular hora de término (assumindo 60 minutos por padrão)
          const horaInicio = new Date(`2000-01-01T${hora}`);
          horaInicio.setMinutes(horaInicio.getMinutes() + 60);
          const horaFim = horaInicio.toTimeString().slice(0, 5);
          document.getElementById("aulaHoraFim").value = horaFim;

          // Popular select de alunos
          await populateAlunosSelect();
          document.getElementById("aulaAluno").value = aula.alunoId;

          document.getElementById("aulaModalidade").value =
            aula.duracao.includes("45")
              ? "Individual"
              : aula.duracao.includes("90")
              ? "Dupla"
              : "Em Grupo";
          document.getElementById("aulaInstrutor").value =
            aula.instrutor || "João Silva";
          document.getElementById("aulaObservacoes").value =
            aula.observacoes || "";

          // Limpar arquivos selecionados
          selectedFiles.aulaModal = [];
          updateFilePreview("aulaFilePreview", selectedFiles.aulaModal);

          // Mostrar anexos existentes
          if (aula.anexos && aula.anexos.length > 0) {
            const anexosList = document.getElementById("aulaAnexosList");
            anexosList.innerHTML = "";

            aula.anexos.forEach((anexo) => {
              const anexoElement = document.createElement("div");
              anexoElement.className = "anexo-item";
              anexoElement.innerHTML = `
                            <div class="anexo-info">
                                <div class="anexo-icon">
                                    <i class="fas fa-file-${
                                      anexo.tipo === "pdf" ? "pdf" : "image"
                                    }"></i>
                                </div>
                                <div class="anexo-details">
                                    <div class="anexo-name">
                                        ${anexo.nome}
                                        <span class="status-badge status-active">Existente</span>
                                    </div>
                                    <div class="anexo-meta">
                                        <span>${anexo.data}</span>
                                        <span>${anexo.tamanho}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="anexo-actions">
                                <button class="file-preview-btn view" onclick="viewAnexo(${
                                  anexo.id
                                }, 'aula')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="file-preview-btn remove" onclick="removeExistingAnexo(${
                                  anexo.id
                                }, 'aula')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        `;
              anexosList.appendChild(anexoElement);
            });

            document.getElementById("aulaAnexosExistentes").style.display =
              "block";
          } else {
            document.getElementById("aulaAnexosExistentes").style.display =
              "none";
          }

          openModal("aulaModal");
        } catch (error) {
          console.error("Erro ao carregar aula para edição:", error);
          showToast("Erro ao carregar aula", "error");
        }
      }

      async function deleteAula(id) {
        if (
          confirm(
            "Tem certeza que deseja excluir esta aula? Esta ação não pode ser desfeita."
          )
        ) {
          try {
            await deleteItem("aulas", id);
            showToast("Aula excluída com sucesso", "success");
            loadAulasTable();
            loadDashboardData();
            loadProximasAulas();
          } catch (error) {
            console.error("Erro ao excluir aula:", error);
            showToast("Erro ao excluir aula", "error");
          }
        }
      }

      // Mensalidades
      async function loadMensalidadesTable() {
        try {
          const mensalidades = await getAllItems("mensalidades");

          // Atualizar métricas
          const hoje = new Date();
          const mesAtual =
            hoje.getFullYear() +
            "-" +
            String(hoje.getMonth() + 1).padStart(2, "0");

          const recebidoMes = mensalidades
            .filter(
              (m) =>
                m.status === "Pago" &&
                m.dataPagamento &&
                m.dataPagamento.startsWith(mesAtual)
            )
            .reduce((total, m) => total + m.valor, 0);

          const pendenteMes = mensalidades
            .filter((m) => m.status === "Pendente")
            .reduce((total, m) => total + m.valor, 0);

          const atrasadoMes = mensalidades
            .filter(
              (m) => m.status === "Pendente" && new Date(m.vencimento) < hoje
            )
            .reduce((total, m) => total + m.valor, 0);

          document.getElementById(
            "recebidoMes"
          ).textContent = `R$ ${recebidoMes.toFixed(2)}`;
          document.getElementById(
            "pendenteMes"
          ).textContent = `R$ ${pendenteMes.toFixed(2)}`;
          document.getElementById(
            "atrasadoMes"
          ).textContent = `R$ ${atrasadoMes.toFixed(2)}`;

          // Carregar tabela de pendentes
          const table = document.getElementById("mensalidadesTable");
          if (table) {
            const pendentes = mensalidades.filter(
              (m) => m.status === "Pendente"
            );

            let html = "";
            pendentes.forEach((mensalidade) => {
              const statusClass =
                mensalidade.status === "Pago"
                  ? "status-paid"
                  : new Date(mensalidade.vencimento) < new Date()
                  ? "status-overdue"
                  : "status-pending";
              const statusText =
                mensalidade.status === "Pago"
                  ? "Pago"
                  : new Date(mensalidade.vencimento) < new Date()
                  ? "Atrasado"
                  : "Pendente";

              html += `
                            <tr>
                                <td>${mensalidade.vencimento}</td>
                                <td>${mensalidade.alunoNome}</td>
                                <td>${mensalidade.formaPagamento}</td>
                                <td>R$ ${mensalidade.valor.toFixed(2)}</td>
                                <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                                <td>
                                    <div class="table-actions">
                                        <button class="action-btn edit" onclick="editMensalidade(${
                                          mensalidade.id
                                        })">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="action-btn delete" onclick="deleteMensalidade(${
                                          mensalidade.id
                                        })">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        `;
            });

            if (pendentes.length === 0) {
              html = `<tr><td colspan="6" style="text-align: center; padding: 2rem; color: var(--gray);">Nenhuma mensalidade pendente</td></tr>`;
            }

            table.innerHTML = html;
          }

          // Carregar tabela de recebidas
          const tableRecebidas = document.getElementById(
            "mensalidadesRecebidasTable"
          );
          if (tableRecebidas) {
            const recebidas = mensalidades.filter((m) => m.status === "Pago");

            let html = "";
            recebidas.forEach((mensalidade) => {
              html += `
                            <tr>
                                <td>${mensalidade.dataPagamento}</td>
                                <td>${mensalidade.alunoNome}</td>
                                <td>${mensalidade.formaPagamento}</td>
                                <td>R$ ${mensalidade.valor.toFixed(2)}</td>
                                <td>${mensalidade.formaPagamento}</td>
                                <td>
                                    <div class="table-actions">
                                        <button class="action-btn edit" onclick="editMensalidade(${
                                          mensalidade.id
                                        })">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="action-btn" onclick="imprimirRecibo(${
                                          mensalidade.id
                                        })">
                                            <i class="fas fa-print"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        `;
            });

            if (recebidas.length === 0) {
              html = `<tr><td colspan="6" style="text-align: center; padding: 2rem; color: var(--gray);">Nenhuma mensalidade recebida</td></tr>`;
            }

            tableRecebidas.innerHTML = html;
          }
        } catch (error) {
          console.error("Erro ao carregar mensalidades:", error);
        }
      }

      // Contas
      async function loadContasTable() {
        try {
          const contas = await getAllItems("contas");

          // Atualizar métricas
          const totalPagar = contas
            .filter((c) => c.tipo === "pagar" && c.status === "Pendente")
            .reduce((total, c) => total + c.valor, 0);

          const totalReceber = contas
            .filter((c) => c.tipo === "receber" && c.status === "Pendente")
            .reduce((total, c) => total + c.valor, 0);

          const totalVencidas = contas
            .filter(
              (c) =>
                c.status === "Pendente" && new Date(c.vencimento) < new Date()
            )
            .reduce((total, c) => total + c.valor, 0);

          document.getElementById(
            "totalPagar"
          ).textContent = `R$ ${totalPagar.toFixed(2)}`;
          document.getElementById(
            "totalReceber"
          ).textContent = `R$ ${totalReceber.toFixed(2)}`;
          document.getElementById(
            "totalVencidas"
          ).textContent = `R$ ${totalVencidas.toFixed(2)}`;

          // Carregar tabela de contas a pagar
          const tablePagar = document.getElementById("contasPagarTable");
          if (tablePagar) {
            const contasPagar = contas.filter((c) => c.tipo === "pagar");

            let html = "";
            contasPagar.forEach((conta) => {
              const statusClass =
                conta.status === "Pago"
                  ? "status-paid"
                  : new Date(conta.vencimento) < new Date()
                  ? "status-overdue"
                  : "status-pending";
              const statusText =
                conta.status === "Pago"
                  ? "Pago"
                  : new Date(conta.vencimento) < new Date()
                  ? "Atrasado"
                  : "Pendente";

              html += `
                            <tr>
                                <td>${conta.descricao}</td>
                                <td>${conta.categoria}</td>
                                <td>${conta.vencimento}</td>
                                <td>R$ ${conta.valor.toFixed(2)}</td>
                                <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                                <td>
                                    <div class="table-actions">
                                        <button class="action-btn edit" onclick="editConta(${
                                          conta.id
                                        })">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="action-btn delete" onclick="deleteConta(${
                                          conta.id
                                        })">
                                            <i class="fas fa-trash"></i>
                                    </button>
                                    </div>
                                </td>
                            </tr>
                        `;
            });

            if (contasPagar.length === 0) {
              html = `<tr><td colspan="6" style="text-align: center; padding: 2rem; color: var(--gray);">Nenhuma conta a pagar</td></tr>`;
            }

            tablePagar.innerHTML = html;
          }

          // Carregar tabela de contas a receber
          const tableReceber = document.getElementById("contasReceberTable");
          if (tableReceber) {
            const contasReceber = contas.filter((c) => c.tipo === "receber");

            let html = "";
            contasReceber.forEach((conta) => {
              const statusClass =
                conta.status === "Recebido"
                  ? "status-paid"
                  : new Date(conta.vencimento) < new Date()
                  ? "status-overdue"
                  : "status-pending";
              const statusText =
                conta.status === "Recebido"
                  ? "Recebido"
                  : new Date(conta.vencimento) < new Date()
                  ? "Atrasado"
                  : "Pendente";

              html += `
                            <tr>
                                <td>${conta.descricao}</td>
                                <td>${conta.categoria}</td>
                                <td>${conta.vencimento}</td>
                                <td>R$ ${conta.valor.toFixed(2)}</td>
                                <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                                <td>
                                    <div class="table-actions">
                                        <button class="action-btn edit" onclick="editConta(${
                                          conta.id
                                        })">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="action-btn delete" onclick="deleteConta(${
                                          conta.id
                                        })">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        `;
            });

            if (contasReceber.length === 0) {
              html = `<tr><td colspan="6" style="text-align: center; padding: 2rem; color: var(--gray);">Nenhuma conta a receber</td></tr>`;
            }

            tableReceber.innerHTML = html;
          }
        } catch (error) {
          console.error("Erro ao carregar contas:", error);
        }
      }

      // Usuários
      async function loadUsuariosTable() {
        try {
          const usuarios = await getAllItems("usuarios");
          const table = document.getElementById("usuariosTable");

          if (!table) return;

          let html = "";
          usuarios.forEach((usuario) => {
            const statusClass =
              usuario.status === "ativo" ? "status-active" : "status-inactive";
            const statusText = usuario.status === "ativo" ? "Ativo" : "Inativo";

            html += `
                        <tr>
                            <td>
                                <div style="display: flex; align-items: center; gap: 0.75rem;">
                                    <div class="user-avatar" style="width: 32px; height: 32px;">${
                                      usuario.avatar
                                    }</div>
                                    ${usuario.nome}
                                </div>
                            </td>
                            <td>${usuario.email}</td>
                            <td>${usuario.role}</td>
                            <td>${usuario.ultimoAcesso || "Nunca"}</td>
                            <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                            <td>
                                <div class="table-actions">
                                    <button class="action-btn edit" onclick="editUsuario(${
                                      usuario.id
                                    })">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn delete" onclick="deleteUsuario(${
                                      usuario.id
                                    })">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
          });

          if (usuarios.length === 0) {
            html = `<tr><td colspan="6" style="text-align: center; padding: 2rem; color: var(--gray);">Nenhum usuário cadastrado</td></tr>`;
          }

          table.innerHTML = html;
        } catch (error) {
          console.error("Erro ao carregar usuários:", error);
        }
      }

      // Planos
      async function loadPlanosTable() {
        try {
          const planos = await getAllItems("planos");
          const alunos = await getAllItems("alunos");

          // Atualizar métricas
          const planosAtivos = planos.filter(
            (p) => p.status === "Ativo"
          ).length;
          const alunosComPlano = alunos.filter(
            (a) => a.status === "ativo"
          ).length;

          document.getElementById("planosAtivos").textContent = planosAtivos;
          document.getElementById("alunosComPlano").textContent =
            alunosComPlano;

          // Carregar tabela
          const table = document.getElementById("planosTable");
          if (!table) return;

          let html = "";
          planos.forEach((plano) => {
            const statusClass =
              plano.status === "Ativo" ? "status-active" : "status-inactive";
            const statusText = plano.status;

            html += `
                        <tr>
                            <td>${plano.nome}</td>
                            <td>${plano.duracao}</td>
                            <td>${plano.aulasSemana}</td>
                            <td>R$ ${plano.valorMensal.toFixed(2)}</td>
                            <td>${plano.alunosAtivos}</td>
                            <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                            <td>
                                <div class="table-actions">
                                    <button class="action-btn edit" onclick="editPlano(${
                                      plano.id
                                    })">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn delete" onclick="deletePlano(${
                                      plano.id
                                    })">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
          });

          if (planos.length === 0) {
            html = `<tr><td colspan="7" style="text-align: center; padding: 2rem; color: var(--gray);">Nenhum plano cadastrado</td></tr>`;
          }

          table.innerHTML = html;
        } catch (error) {
          console.error("Erro ao carregar planos:", error);
        }
      }

      // Relatórios
      async function loadRelatoriosTable() {
        try {
          const mensalidades = await getAllItems("mensalidades");
          const contas = await getAllItems("contas");

          // Calcular resumo financeiro
          const hoje = new Date();
          const mesAtual =
            hoje.getFullYear() +
            "-" +
            String(hoje.getMonth() + 1).padStart(2, "0");

          const receitasMensalidades = mensalidades
            .filter(
              (m) =>
                m.status === "Pago" &&
                m.dataPagamento &&
                m.dataPagamento.startsWith(mesAtual)
            )
            .reduce((total, m) => total + m.valor, 0);

          const despesasContas = contas
            .filter((c) => c.tipo === "pagar" && c.status === "Pago")
            .reduce((total, c) => total + c.valor, 0);

          const table = document.getElementById("relatorioFinanceiroTable");
          if (!table) return;

          const html = `
                    <tr>
                        <td>Mensalidades</td>
                        <td>R$ ${receitasMensalidades.toFixed(2)}</td>
                        <td>R$ 0,00</td>
                        <td>R$ ${receitasMensalidades.toFixed(2)}</td>
                        <td><span class="trend-up">+8%</span></td>
                    </tr>
                    <tr>
                        <td>Despesas Operacionais</td>
                        <td>R$ 0,00</td>
                        <td>R$ ${despesasContas.toFixed(2)}</td>
                        <td>R$ ${(despesasContas * -1).toFixed(2)}</td>
                        <td><span class="trend-down">-3%</span></td>
                    </tr>
                    <tr>
                        <td>Total</td>
                        <td>R$ ${receitasMensalidades.toFixed(2)}</td>
                        <td>R$ ${despesasContas.toFixed(2)}</td>
                        <td>R$ ${(
                          receitasMensalidades - despesasContas
                        ).toFixed(2)}</td>
                        <td><span class="trend-up">+5%</span></td>
                    </tr>
                `;

          table.innerHTML = html;
        } catch (error) {
          console.error("Erro ao carregar relatórios:", error);
        }
      }

      // Funções auxiliares
      async function populateAlunosSelect(selectId = "aulaAluno") {
        try {
          const alunos = await getAllItems("alunos");
          const select = document.getElementById(selectId);

          if (!select) return;

          // Manter a opção padrão
          const defaultOption = select.options[0];
          select.innerHTML = "";
          select.appendChild(defaultOption);

          alunos
            .filter((a) => a.status === "ativo")
            .forEach((aluno) => {
              const option = document.createElement("option");
              option.value = aluno.id;
              option.textContent = aluno.nome;
              select.appendChild(option);
            });
        } catch (error) {
          console.error("Erro ao popular select de alunos:", error);
        }
      }

      // Modais
      function initModais() {
        // Modal Aluno (existente)
        document
          .getElementById("novoAlunoBtn")
          .addEventListener("click", () => {
            if (!currentUser) {
              showToast("Faça login para acessar esta funcionalidade", "error");
              return;
            }
            currentEditId = null;
            resetForm("alunoForm");
            selectedFiles.alunoModal = [];
            updateFilePreview("alunoFilePreview", selectedFiles.alunoModal);
            document.getElementById("alunoAnexosExistentes").style.display =
              "none";
            document.getElementById("alunoModalTitle").textContent =
              "Novo Aluno";
            openModal("alunoModal");
          });

        document
          .getElementById("closeAlunoModal")
          .addEventListener("click", () => closeModal("alunoModal"));
        document
          .getElementById("cancelAluno")
          .addEventListener("click", () => closeModal("alunoModal"));
        document
          .getElementById("saveAluno")
          .addEventListener("click", async function (e) {
            e.preventDefault();
            await saveAluno();
          });

        // Modal Aula (existente)
        document
          .getElementById("novaAulaBtn")
          .addEventListener("click", openAulaModal);
        document
          .getElementById("agendarAulaBtn")
          .addEventListener("click", openAulaModal);

        document
          .getElementById("closeAulaModal")
          .addEventListener("click", () => closeModal("aulaModal"));
        document
          .getElementById("cancelAula")
          .addEventListener("click", () => closeModal("aulaModal"));
        document
          .getElementById("saveAula")
          .addEventListener("click", async function (e) {
            e.preventDefault();
            await saveAula();
          });

        // CORREÇÃO DO RELATÓRIO: Modal Nova Cobrança
        document
          .getElementById("novaCobrancaBtn")
          .addEventListener("click", openCobrancaModal);

        document
          .getElementById("closeCobrancaModal")
          .addEventListener("click", () => closeModal("cobrancaModal"));
        document
          .getElementById("cancelCobranca")
          .addEventListener("click", () => closeModal("cobrancaModal"));
        document
          .getElementById("saveCobranca")
          .addEventListener("click", async function (e) {
            e.preventDefault();
            await saveCobranca();
          });

        // CORREÇÃO DO RELATÓRIO: Modal Nova Conta
        document
          .getElementById("novaContaBtn")
          .addEventListener("click", openContaModal);

        document
          .getElementById("closeContaModal")
          .addEventListener("click", () => closeModal("contaModal"));
        document
          .getElementById("cancelConta")
          .addEventListener("click", () => closeModal("contaModal"));
        document
          .getElementById("saveConta")
          .addEventListener("click", async function (e) {
            e.preventDefault();
            await saveConta();
          });

        // CORREÇÃO DO RELATÓRIO: Modal Novo Usuário
        document
          .getElementById("novoUsuarioBtn")
          .addEventListener("click", openUsuarioModal);

        document
          .getElementById("closeUsuarioModal")
          .addEventListener("click", () => closeModal("usuarioModal"));
        document
          .getElementById("cancelUsuario")
          .addEventListener("click", () => closeModal("usuarioModal"));
        document
          .getElementById("saveUsuario")
          .addEventListener("click", async function (e) {
            e.preventDefault();
            await saveUsuario();
          });

        // CORREÇÃO DO RELATÓRIO: Modal Novo Plano
        document
          .getElementById("novoPlanoBtn")
          .addEventListener("click", openPlanoModal);

        document
          .getElementById("closePlanoModal")
          .addEventListener("click", () => closeModal("planoModal"));
        document
          .getElementById("cancelPlano")
          .addEventListener("click", () => closeModal("planoModal"));
        document
          .getElementById("savePlano")
          .addEventListener("click", async function (e) {
            e.preventDefault();
            await savePlano();
          });

        // Fechar modais ao clicar fora
        document.querySelectorAll(".modal-overlay").forEach((modal) => {
          modal.addEventListener("click", function (e) {
            if (e.target === this) {
              closeModal(this.id);
            }
          });
        });
      }

      async function openAulaModal() {
        if (!currentUser) {
          showToast("Faça login para acessar esta funcionalidade", "error");
          return;
        }

        currentEditId = null;
        resetForm("aulaForm");
        selectedFiles.aulaModal = [];
        updateFilePreview("aulaFilePreview", selectedFiles.aulaModal);
        document.getElementById("aulaAnexosExistentes").style.display = "none";
        document.getElementById("aulaModalTitle").textContent =
          "Agendar Nova Aula";

        // Definir data padrão para hoje
        const hoje = new Date().toISOString().split("T")[0];
        document.getElementById("aulaData").value = hoje;

        // Definir horário padrão
        const agora = new Date();
        const horaInicio = `${String(agora.getHours()).padStart(
          2,
          "0"
        )}:${String(agora.getMinutes()).padStart(2, "0")}`;
        document.getElementById("aulaHoraInicio").value = horaInicio;

        // Calcular hora de término (60 minutos depois)
        const horaFimDate = new Date(agora.getTime() + 60 * 60000);
        const horaFim = `${String(horaFimDate.getHours()).padStart(
          2,
          "0"
        )}:${String(horaFimDate.getMinutes()).padStart(2, "0")}`;
        document.getElementById("aulaHoraFim").value = horaFim;

        // Popular select de alunos
        await populateAlunosSelect();

        openModal("aulaModal");
      }

      // CORREÇÃO: Função para abrir modal de Nova Cobrança
      async function openCobrancaModal() {
        if (!currentUser) {
          showToast("Faça login para acessar esta funcionalidade", "error");
          return;
        }

        currentEditId = null;
        resetForm("cobrancaForm");
        
        // Definir data de vencimento padrão (30 dias a partir de hoje)
        const hoje = new Date();
        const vencimento = new Date(hoje);
        vencimento.setDate(vencimento.getDate() + 30);
        document.getElementById("cobrancaVencimento").value = vencimento.toISOString().split("T")[0];
        
        // Popular select de alunos
        await populateAlunosSelect("cobrancaAluno");

        openModal("cobrancaModal");
      }

      // CORREÇÃO: Função para abrir modal de Nova Conta
      async function openContaModal() {
        if (!currentUser) {
          showToast("Faça login para acessar esta funcionalidade", "error");
          return;
        }

        currentEditId = null;
        resetForm("contaForm");
        
        // Definir data de vencimento padrão (30 dias a partir de hoje)
        const hoje = new Date();
        const vencimento = new Date(hoje);
        vencimento.setDate(vencimento.getDate() + 30);
        document.getElementById("contaVencimento").value = vencimento.toISOString().split("T")[0];

        openModal("contaModal");
      }

      // CORREÇÃO: Função para abrir modal de Novo Usuário
      async function openUsuarioModal() {
        if (!currentUser) {
          showToast("Faça login para acessar esta funcionalidade", "error");
          return;
        }

        currentEditId = null;
        resetForm("usuarioForm");

        openModal("usuarioModal");
      }

      // CORREÇÃO: Função para abrir modal de Novo Plano
      async function openPlanoModal() {
        if (!currentUser) {
          showToast("Faça login para acessar esta funcionalidade", "error");
          return;
        }

        currentEditId = null;
        resetForm("planoForm");
        
        // Adicionar listener para calcular valor total
        document.getElementById("planoDuracao").addEventListener("change", calcularValorTotalPlano);
        document.getElementById("planoValorMensal").addEventListener("input", calcularValorTotalPlano);

        openModal("planoModal");
      }

      function calcularValorTotalPlano() {
        const duracao = parseInt(document.getElementById("planoDuracao").value) || 1;
        const valorMensal = parseFloat(document.getElementById("planoValorMensal").value) || 0;
        const valorTotal = duracao * valorMensal;
        
        document.getElementById("planoValorTotal").value = 
          isNaN(valorTotal) ? "" : `R$ ${valorTotal.toFixed(2)} (${duracao} meses)`;
      }

      function openModal(modalId) {
        document.getElementById(modalId).classList.add("active");
        document.body.style.overflow = "hidden";
      }

      function closeModal(modalId) {
        document.getElementById(modalId).classList.remove("active");
        document.body.style.overflow = "auto";

        // Limpar arquivos selecionados se aplicável
        if (modalId === "alunoModal") {
          selectedFiles.alunoModal = [];
        } else if (modalId === "aulaModal") {
          selectedFiles.aulaModal = [];
        }
      }

      function resetForm(formId) {
        const form = document.getElementById(formId);
        if (form) {
          form.reset();
        }
      }

      // Salvar Aluno
      async function saveAluno() {
        try {
          const alunoData = {
            nome: document.getElementById("alunoNome").value,
            cpf: document.getElementById("alunoCPF").value,
            dataNascimento: document.getElementById("alunoNascimento").value,
            telefone: document.getElementById("alunoTelefone").value,
            email: document.getElementById("alunoEmail").value,
            plano: document.getElementById("alunoPlano").value,
            dataInicio:
              document.getElementById("alunoInicio").value ||
              new Date().toISOString().split("T")[0],
            status: document.getElementById("alunoStatus").value,
            observacoes: document.getElementById("alunoObservacoes").value,
            anexos: [],
          };

          if (!alunoData.nome || !alunoData.cpf) {
            showToast("Nome e CPF são obrigatórios", "error");
            return;
          }

          if (currentEditId) {
            // Editar aluno existente
            alunoData.id = currentEditId;
            const alunoExistente = await getItem("alunos", currentEditId);
            if (alunoExistente) {
              alunoData.anexos = alunoExistente.anexos || [];
            }
            await updateItem("alunos", alunoData);
            showToast("Aluno atualizado com sucesso", "success");
          } else {
            // Criar novo aluno
            const result = await addItem("alunos", alunoData);
            showToast("Aluno cadastrado com sucesso", "success");
          }

          closeModal("alunoModal");
          loadAlunosTable();
          loadDashboardData();
          await populateAlunosSelect();
        } catch (error) {
          console.error("Erro ao salvar aluno:", error);
          showToast("Erro ao salvar aluno", "error");
        }
      }

      // Salvar Aula
      async function saveAula() {
        try {
          const alunoSelect = document.getElementById("aulaAluno");
          const alunoId = parseInt(alunoSelect.value);
          const alunoOption = alunoSelect.options[alunoSelect.selectedIndex];

          if (!alunoId) {
            showToast("Selecione um aluno", "error");
            return;
          }

          const data = document.getElementById("aulaData").value;
          const horaInicio = document.getElementById("aulaHoraInicio").value;
          const horaFim = document.getElementById("aulaHoraFim").value;

          if (!data || !horaInicio || !horaFim) {
            showToast(
              "Data, hora de início e hora de término são obrigatórios",
              "error"
            );
            return;
          }

          // Calcular duração
          const inicio = new Date(`${data}T${horaInicio}`);
          const fim = new Date(`${data}T${horaFim}`);
          const diffMs = fim - inicio;
          const diffMins = Math.round(diffMs / 60000);

          const aulaData = {
            horario: `${data} ${horaInicio}`,
            aluno: alunoOption.textContent,
            alunoId: alunoId,
            duracao: `${diffMins} min`,
            instrutor: document.getElementById("aulaInstrutor").value,
            sala: "Sala 1",
            status: "Confirmada",
            observacoes: document.getElementById("aulaObservacoes").value,
            anexos: [],
          };

          if (currentEditId) {
            // Editar aula existente
            aulaData.id = currentEditId;
            const aulaExistente = await getItem("aulas", currentEditId);
            if (aulaExistente) {
              aulaData.anexos = aulaExistente.anexos || [];
            }
            await updateItem("aulas", aulaData);
            showToast("Aula atualizada com sucesso", "success");
          } else {
            // Criar nova aula
            await addItem("aulas", aulaData);
            showToast("Aula agendada com sucesso", "success");
          }

          closeModal("aulaModal");
          loadAulasTable();
          loadDashboardData();
          loadProximasAulas();
          initCharts();
        } catch (error) {
          console.error("Erro ao salvar aula:", error);
          showToast("Erro ao salvar aula", "error");
        }
      }

      // CORREÇÃO: Salvar Cobrança
      async function saveCobranca() {
        try {
          const alunoSelect = document.getElementById("cobrancaAluno");
          const alunoId = parseInt(alunoSelect.value);
          const alunoOption = alunoSelect.options[alunoSelect.selectedIndex];

          if (!alunoId) {
            showToast("Selecione um aluno", "error");
            return;
          }

          const valor = parseFloat(document.getElementById("cobrancaValor").value);
          const vencimento = document.getElementById("cobrancaVencimento").value;
          const tipo = document.getElementById("cobrancaTipo").value;

          if (!valor || valor <= 0 || !vencimento || !tipo) {
            showToast("Preencha todos os campos obrigatórios", "error");
            return;
          }

          const cobrancaData = {
            alunoId: alunoId,
            alunoNome: alunoOption.textContent,
            valor: valor,
            vencimento: vencimento,
            tipo: tipo,
            formaPagamento: document.getElementById("cobrancaFormaPagamento").value,
            status: document.getElementById("cobrancaStatus").value,
            dataPagamento: null,
            descricao: document.getElementById("cobrancaDescricao").value || `Cobrança ${tipo} - ${alunoOption.textContent}`
          };

          // Se status for "pago", definir data de pagamento como hoje
          if (cobrancaData.status === "pago" || cobrancaData.status === "Pago") {
            cobrancaData.dataPagamento = new Date().toISOString().split("T")[0];
          }

          await addItem("mensalidades", cobrancaData);
          showToast("Cobrança cadastrada com sucesso", "success");

          closeModal("cobrancaModal");
          loadMensalidadesTable();
          await updateSidebarBadges();
        } catch (error) {
          console.error("Erro ao salvar cobrança:", error);
          showToast("Erro ao salvar cobrança", "error");
        }
      }

      // CORREÇÃO: Salvar Conta
      async function saveConta() {
        try {
          const descricao = document.getElementById("contaDescricao").value;
          const valor = parseFloat(document.getElementById("contaValor").value);
          const vencimento = document.getElementById("contaVencimento").value;
          const tipo = document.getElementById("contaTipo").value;

          if (!descricao || !valor || valor <= 0 || !vencimento || !tipo) {
            showToast("Preencha todos os campos obrigatórios", "error");
            return;
          }

          const contaData = {
            descricao: descricao,
            categoria: document.getElementById("contaCategoria").value,
            vencimento: vencimento,
            valor: valor,
            status: document.getElementById("contaStatus").value,
            tipo: tipo,
            formaPagamento: document.getElementById("contaFormaPagamento").value,
            observacoes: document.getElementById("contaObservacoes").value
          };

          await addItem("contas", contaData);
          showToast("Conta cadastrada com sucesso", "success");

          closeModal("contaModal");
          loadContasTable();
          await updateSidebarBadges();
        } catch (error) {
          console.error("Erro ao salvar conta:", error);
          showToast("Erro ao salvar conta", "error");
        }
      }

      // CORREÇÃO: Salvar Usuário
      async function saveUsuario() {
        try {
          const nome = document.getElementById("usuarioNome").value;
          const email = document.getElementById("usuarioEmail").value;
          const senha = document.getElementById("usuarioSenha").value;
          const confirmarSenha = document.getElementById("usuarioConfirmarSenha").value;
          const perfil = document.getElementById("usuarioPerfil").value;

          if (!nome || !email || !senha || !confirmarSenha || !perfil) {
            showToast("Preencha todos os campos obrigatórios", "error");
            return;
          }

          if (senha.length < 6) {
            showToast("A senha deve ter no mínimo 6 caracteres", "error");
            return;
          }

          if (senha !== confirmarSenha) {
            showToast("As senhas não coincidem", "error");
            return;
          }

          // Verificar se email já existe
          const usuarios = await getAllItems("usuarios");
          const emailExistente = usuarios.find(u => u.email === email);
          if (emailExistente && !currentEditId) {
            showToast("Este email já está cadastrado", "error");
            return;
          }

          const permissoes = [];
          if (document.getElementById("permissaoAlunos").checked) permissoes.push("alunos");
          if (document.getElementById("permissaoAulas").checked) permissoes.push("aulas");
          if (document.getElementById("permissaoFinanceiro").checked) permissoes.push("financeiro");
          if (document.getElementById("permissaoRelatorios").checked) permissoes.push("relatorios");

          const usuarioData = {
            nome: nome,
            email: email,
            senha: senha,
            role: perfil.charAt(0).toUpperCase() + perfil.slice(1),
            avatar: nome.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2),
            status: document.getElementById("usuarioStatus").value,
            ultimoAcesso: null,
            telefone: document.getElementById("usuarioTelefone").value,
            permissoes: permissoes
          };

          if (currentEditId) {
            usuarioData.id = currentEditId;
            await updateItem("usuarios", usuarioData);
            showToast("Usuário atualizado com sucesso", "success");
          } else {
            await addItem("usuarios", usuarioData);
            showToast("Usuário cadastrado com sucesso", "success");
          }

          closeModal("usuarioModal");
          loadUsuariosTable();
        } catch (error) {
          console.error("Erro ao salvar usuário:", error);
          showToast("Erro ao salvar usuário", "error");
        }
      }

      // CORREÇÃO: Salvar Plano
      async function savePlano() {
        try {
          const nome = document.getElementById("planoNome").value;
          const duracao = parseInt(document.getElementById("planoDuracao").value);
          const aulasSemana = document.getElementById("planoAulasSemana").value;
          const valorMensal = parseFloat(document.getElementById("planoValorMensal").value);

          if (!nome || !duracao || !aulasSemana || !valorMensal || valorMensal <= 0) {
            showToast("Preencha todos os campos obrigatórios", "error");
            return;
          }

          const beneficios = [];
          if (document.getElementById("beneficioAvaliacao").checked) beneficios.push("Avaliação Física Inclusa");
          if (document.getElementById("beneficioMaterial").checked) beneficios.push("Material de Apoio");
          if (document.getElementById("beneficioAulaExperimental").checked) beneficios.push("Aula Experimental");
          if (document.getElementById("beneficioDesconto").checked) beneficios.push("Desconto em Produtos");

          const planoData = {
            nome: nome,
            duracao: `${duracao} ${duracao === 1 ? 'mês' : 'meses'}`,
            aulasSemana: aulasSemana,
            valorMensal: valorMensal,
            alunosAtivos: 0,
            status: document.getElementById("planoStatus").value,
            descricao: document.getElementById("planoDescricao").value,
            tipoAula: document.getElementById("planoTipoAula").value,
            beneficios: beneficios
          };

          if (currentEditId) {
            planoData.id = currentEditId;
            await updateItem("planos", planoData);
            showToast("Plano atualizado com sucesso", "success");
          } else {
            await addItem("planos", planoData);
            showToast("Plano cadastrado com sucesso", "success");
          }

          closeModal("planoModal");
          loadPlanosTable();
        } catch (error) {
          console.error("Erro ao salvar plano:", error);
          showToast("Erro ao salvar plano", "error");
        }
      }

      // Calendário
      function initCalendar() {
        updateCalendar();

        document
          .getElementById("prevMonthBtn")
          .addEventListener("click", function () {
            calendarMonth--;
            if (calendarMonth < 0) {
              calendarMonth = 11;
              calendarYear--;
            }
            updateCalendar();
          });

        document
          .getElementById("nextMonthBtn")
          .addEventListener("click", function () {
            calendarMonth++;
            if (calendarMonth > 11) {
              calendarMonth = 0;
              calendarYear++;
            }
            updateCalendar();
          });

        document
          .getElementById("filterAulasDia")
          .addEventListener("change", loadAulasTable);
      }

      async function updateCalendar() {
        const calendarTitle = document.getElementById("calendarTitle");
        const calendarDays = document.getElementById("calendarDays");

        const monthNames = [
          "Janeiro",
          "Fevereiro",
          "Março",
          "Abril",
          "Maio",
          "Junho",
          "Julho",
          "Agosto",
          "Setembro",
          "Outubro",
          "Novembro",
          "Dezembro",
        ];
        calendarTitle.textContent = `${monthNames[calendarMonth]} ${calendarYear}`;

        // Obter primeiro dia do mês
        const firstDay = new Date(calendarYear, calendarMonth, 1);
        const lastDay = new Date(calendarYear, calendarMonth + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startingDay = firstDay.getDay();

        // Obter aulas do mês
        let aulasMes = [];
        try {
          const todasAulas = await getAllItems("aulas");
          aulasMes = todasAulas.filter((aula) => {
            const aulaDate = new Date(aula.horario);
            return (
              aulaDate.getMonth() === calendarMonth &&
              aulaDate.getFullYear() === calendarYear
            );
          });
        } catch (error) {
          console.error("Erro ao carregar aulas para o calendário:", error);
        }

        let html = "";
        const hoje = new Date();

        // Dias vazios antes do primeiro dia do mês
        for (let i = 0; i < startingDay; i++) {
          html += `<div class="calendar-day"></div>`;
        }

        // Dias do mês
        for (let day = 1; day <= daysInMonth; day++) {
          const currentDate = new Date(calendarYear, calendarMonth, day);
          const isToday =
            currentDate.getDate() === hoje.getDate() &&
            currentDate.getMonth() === hoje.getMonth() &&
            currentDate.getFullYear() === hoje.getFullYear();

          const dateStr = `${calendarYear}-${String(calendarMonth + 1).padStart(
            2,
            "0"
          )}-${String(day).padStart(2, "0")}`;
          const aulasDia = aulasMes.filter((aula) =>
            aula.horario.startsWith(dateStr)
          );

          html += `<div class="calendar-day ${isToday ? "today" : ""}">`;
          html += `<div class="day-number">${day}</div>`;

          aulasDia.slice(0, 3).forEach((aula) => {
            const [_, hora] = aula.horario.split(" ");
            html += `<div class="calendar-event">${hora} - ${aula.aluno}</div>`;
          });

          if (aulasDia.length > 3) {
            html += `<div class="calendar-event">+ ${
              aulasDia.length - 3
            } mais</div>`;
          }

          html += `</div>`;
        }

        calendarDays.innerHTML = html;
      }

      // Tabs
      function initTabs() {
        document.querySelectorAll(".tabs").forEach((tabsContainer) => {
          const tabs = tabsContainer.querySelectorAll(".tab");
          const tabContents = document.querySelectorAll(".tab-content");

          tabs.forEach((tab) => {
            tab.addEventListener("click", function () {
              const tabId = this.dataset.tab;

              // Remover classe active de todas as tabs
              tabs.forEach((t) => t.classList.remove("active"));
              tabContents.forEach((content) =>
                content.classList.remove("active")
              );

              // Adicionar classe active à tab clicada
              this.classList.add("active");

              // Mostrar conteúdo correspondente
              const tabContent = document.getElementById(`${tabId}-tab`);
              if (tabContent) {
                tabContent.classList.add("active");
              }
            });
          });
        });
      }

      // Upload de Arquivos
      function initFileUploads() {
        // Upload para aluno
        const alunoFileInput = document.getElementById("alunoFileInput");
        const alunoFileUpload = document.getElementById("alunoFileUpload");

        if (alunoFileInput && alunoFileUpload) {
          alunoFileInput.addEventListener("change", function (e) {
            handleFileSelect(e, "alunoModal");
          });

          setupDragAndDrop(alunoFileUpload, alunoFileInput, "alunoModal");
        }

        // Upload para aula
        const aulaFileInput = document.getElementById("aulaFileInput");
        const aulaFileUpload = document.getElementById("aulaFileUpload");

        if (aulaFileInput && aulaFileUpload) {
          aulaFileInput.addEventListener("change", function (e) {
            handleFileSelect(e, "aulaModal");
          });

          setupDragAndDrop(aulaFileUpload, aulaFileInput, "aulaModal");
        }
      }

      function setupDragAndDrop(container, fileInput, modalType) {
        container.addEventListener("dragover", function (e) {
          e.preventDefault();
          this.classList.add("drag-over");
        });

        container.addEventListener("dragleave", function (e) {
          e.preventDefault();
          this.classList.remove("drag-over");
        });

        container.addEventListener("drop", function (e) {
          e.preventDefault();
          this.classList.remove("drag-over");

          if (e.dataTransfer.files.length) {
            fileInput.files = e.dataTransfer.files;
            handleFileSelect({ target: fileInput }, modalType);
          }
        });
      }

      function handleFileSelect(event, modalType) {
        const files = event.target.files;
        if (!files.length) return;

        for (let i = 0; i < files.length; i++) {
          const file = files[i];

          // Verificar tamanho do arquivo (10MB máximo)
          if (file.size > 10 * 1024 * 1024) {
            showToast(`Arquivo ${file.name} excede 10MB`, "error");
            continue;
          }

          const fileData = {
            id: Date.now() + i,
            nome: file.name,
            tamanho: formatFileSize(file.size),
            tipo: getFileType(file.name),
            arquivo: file,
            data: new Date().toISOString().split("T")[0],
          };

          selectedFiles[modalType].push(fileData);
        }

        updateFilePreview(`${modalType}FilePreview`, selectedFiles[modalType]);
      }

      function updateFilePreview(previewContainerId, files) {
        const container = document.getElementById(previewContainerId);
        if (!container) return;

        container.innerHTML = "";

        files.forEach((file) => {
          const fileElement = document.createElement("div");
          fileElement.className = "file-preview-item";
          fileElement.innerHTML = `
                    <div class="file-preview-info">
                        <div class="file-preview-icon">
                            <i class="fas fa-file-${
                              file.tipo === "pdf" ? "pdf" : "image"
                            }"></i>
                        </div>
                        <div>
                            <div class="file-preview-name">${file.nome}</div>
                            <div class="file-preview-size">${file.tamanho} • ${
            file.data
          }</div>
                        </div>
                    </div>
                    <div class="file-preview-actions">
                        <button class="file-preview-btn view" onclick="viewFilePreview('${
                          file.id
                        }', this)">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="file-preview-btn remove" onclick="removeFilePreview('${
                          file.id
                        }', this)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
          container.appendChild(fileElement);
        });
      }

      function formatFileSize(bytes) {
        if (bytes < 1024) return bytes + " B";
        if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + " KB";
        return (bytes / (1024 * 1024)).toFixed(1) + " MB";
      }

      function getFileType(filename) {
        const ext = filename.split(".").pop().toLowerCase();
        if (["pdf"].includes(ext)) return "pdf";
        if (["jpg", "jpeg", "png", "gif", "bmp"].includes(ext)) return "image";
        return "document";
      }

      // Funções globais para botões
      window.removeToast = function (toastId) {
        const toast = document.getElementById(toastId);
        if (toast) {
          toast.style.animation = "slideOutRight 0.3s ease";
          setTimeout(() => {
            if (toast.parentNode) {
              toast.parentNode.removeChild(toast);
            }
          }, 300);
        }
      };

      window.logout = logout;

      window.viewFilePreview = function (fileId, button) {
        const modalType =
          button.closest(".modal").id === "alunoModal"
            ? "alunoModal"
            : "aulaModal";
        const file = selectedFiles[modalType].find((f) => f.id == fileId);

        if (file && file.arquivo) {
          const url = URL.createObjectURL(file.arquivo);
          window.open(url, "_blank");
        } else {
          showToast("Arquivo não disponível para visualização", "warning");
        }
      };

      window.removeFilePreview = function (fileId, button) {
        const modalType =
          button.closest(".modal").id === "alunoModal"
            ? "alunoModal"
            : "aulaModal";
        selectedFiles[modalType] = selectedFiles[modalType].filter(
          (f) => f.id != fileId
        );
        updateFilePreview(`${modalType}FilePreview`, selectedFiles[modalType]);
      };

      window.viewAnexo = function (anexoId, entityType) {
        showToast(`Visualizando anexo ${anexoId} do ${entityType}`, "info");
      };

      window.removeExistingAnexo = function (anexoId, entityType) {
        if (confirm("Tem certeza que deseja remover este anexo?")) {
          showToast(`Anexo ${anexoId} removido do ${entityType}`, "success");
        }
      };

      // Toast Notifications
      function showToast(message, type = "info") {
        const toastContainer = document.getElementById("toastContainer");
        if (!toastContainer) return;

        const toastId = "toast-" + Date.now();
        const icon =
          type === "success"
            ? "fas fa-check-circle"
            : type === "error"
            ? "fas fa-exclamation-circle"
            : type === "warning"
            ? "fas fa-exclamation-triangle"
            : "fas fa-info-circle";

        const toast = document.createElement("div");
        toast.className = `toast ${type}`;
        toast.id = toastId;
        toast.innerHTML = `
                <i class="${icon} toast-icon"></i>
                <div class="toast-message">${message}</div>
                <button class="toast-close" onclick="removeToast('${toastId}')">
                    <i class="fas fa-times"></i>
                </button>
            `;

        toastContainer.appendChild(toast);

        setTimeout(() => {
          removeToast(toastId);
        }, 5000);
      }

      // Setup dos event listeners
      function setupEventListeners() {
        document
          .getElementById("userMenuBtn")
          .addEventListener("click", function () {
            showToast("Menu do usuário", "info");
          });

        document
          .getElementById("themeToggle")
          .addEventListener("click", toggleTheme);
        document
          .getElementById("themeToggleTop")
          .addEventListener("click", toggleTheme);

        document
          .getElementById("toggleFiltersBtn")
          .addEventListener("click", function () {
            const filters = document.getElementById("alunosFilters");
            filters.style.display =
              filters.style.display === "none" ? "block" : "none";
          });

        document
          .getElementById("clearFiltersBtn")
          .addEventListener("click", function () {
            document.getElementById("filterStatus").value = "";
            document.getElementById("filterPlano").value = "";
            document.getElementById("filterDataInicio").value = "";
            document.getElementById("filterBusca").value = "";
            showToast("Filtros limpos", "info");
          });

        document
          .getElementById("applyFiltersBtn")
          .addEventListener("click", function () {
            showToast("Filtros aplicados", "success");
          });

        document
          .getElementById("exportDashboardBtn")
          .addEventListener("click", function () {
            showToast("Exportando dados do dashboard...", "info");
          });

        document
          .getElementById("printAgendaBtn")
          .addEventListener("click", function () {
            window.print();
          });

        document
          .getElementById("saveSettingsBtn")
          .addEventListener("click", function () {
            showToast("Configurações salvas com sucesso", "success");
          });

        document
          .getElementById("gerarPDFBtn")
          .addEventListener("click", function () {
            showToast("Gerando relatório em PDF...", "info");
          });

        // Filtros
        document
          .getElementById("filterProximasAulas")
          .addEventListener("change", loadProximasAulas);
        document
          .getElementById("sortAlunos")
          .addEventListener("change", loadAlunosTable);
      }

      function toggleTheme() {
        const body = document.body;
        const isDark = body.classList.contains("dark-theme");

        if (isDark) {
          body.classList.remove("dark-theme");
          document.querySelectorAll(".fa-moon").forEach((icon) => {
            icon.classList.replace("fa-sun", "fa-moon");
          });
          showToast("Tema claro ativado", "info");
        } else {
          body.classList.add("dark-theme");
          document.querySelectorAll(".fa-moon").forEach((icon) => {
            icon.classList.replace("fa-moon", "fa-sun");
          });
          showToast("Tema escuro ativado", "info");
        }
      }

      // Inicializar filtro de aulas do dia
      document
        .getElementById("filterAulasDia")
        .addEventListener("change", loadAulasTable);
    </script>
  </body>
</html>
